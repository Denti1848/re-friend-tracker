import * as tslib_1 from "tslib";
import { PageElement } from "../page-element";
import { Input, Output, Component } from "@angular/core";
import { KeyUtility } from "../../../utility/key-utility";
import { ButtonDetail } from "./button-detail";
import { StringUtility } from "../../../utility/string-utility";
import { ColorUtility } from "../../../utility/color-utility";
let ButtonComponent = class ButtonComponent {
};
tslib_1.__decorate([
    Input("button"),
    Output("button")
], ButtonComponent.prototype, "button", void 0);
ButtonComponent = tslib_1.__decorate([
    Component({
        selector: "path-button",
        template: "<a (click)=\"button.onClick()\" class=\"fa-links\">\r\n\t<div tooltip=\"{{button.tooltip}}\" *ngIf=\"button.visible\" class=\"thumbnail tile {{button.cssButtonTarget ? 'tile-button' : ''}} {{(button.width <= 1 ? 'tile-medium' : (button.width == 2 ? 'tile-wide' : (button.width == 3 ? 'tile-wide-3' : (button.width >= 4 ? 'tile-wide-4' : ''))))}} {{button.cssGroupBorder}} {{button.cssClass}}\" [ngStyle]=\"button.cssStyle\">\r\n\t\t<div class=\"h3 truncate\">{{button.name}}</div>\r\n\t\t<span class=\"truncate\" *ngFor='let detail of button.details; let last = last;'>\r\n                    <span class=\"h4 m-t-5\" [innerHTML]=\"detail.text\"></span><small [hidden]=\"last\">&nbsp;&bull;&nbsp;</small></span>\r\n\t\t<div class=\"h4 m-t-5\"></div>\r\n\t\t<i class=\"fa fa-2x {{button.icon}}\"></i>\r\n\t</div>\r\n</a>\r\n"
    })
], ButtonComponent);
export { ButtonComponent };
export class Button extends PageElement {
    constructor(app, pathService, translationService) {
        super(app);
        this.pathService = pathService;
        this.translationService = translationService;
        this._details = [];
    }
    onClick() {
        if (this._handler != null) {
            this._handler.doClick(this);
            return;
        }
        if (!StringUtility.isEmpty(this._url)) {
            this.pathService.serverGet(this.app.getBackendUrl(), this._url, () => {
                this.app.refreshCurrentPage();
            }, null);
        }
        if (!StringUtility.isEmpty(this._page)) {
            this.app.setCurrentPage(this._page, this);
            return;
        }
        if (!StringUtility.isEmpty(this._form)) {
            this.app.setCurrentForm(this._form, this.key, this._formHandler, this);
            return;
        }
    }
    setIcon(icon) {
        this.icon = icon;
    }
    setForm(form) {
        this.form = form;
    }
    setFormHandler(formHandler) {
        this.formHandler = formHandler;
    }
    setPage(page) {
        this.page = page;
    }
    setKey(key) {
        this.key = key;
    }
    getApp() {
        return this.app;
    }
    getName() {
        return this.name;
    }
    get icon() {
        return this._icon;
    }
    set icon(value) {
        this._icon = value;
    }
    get cssStyle() {
        return this._cssStyle;
    }
    get cssClass() {
        return this._cssClass;
    }
    get cssButtonTarget() {
        return this._cssButtonTarget;
    }
    get cssGroupBorder() {
        return this._cssGroupBorder;
    }
    set cssGroupBorder(value) {
        this._cssGroupBorder = value;
    }
    get handler() {
        return this._handler;
    }
    set handler(value) {
        this._handler = value;
    }
    get details() {
        return this._details;
    }
    set details(value) {
        this._details = value;
    }
    get page() {
        return this._page;
    }
    set page(value) {
        this._page = value;
    }
    get form() {
        return this._form;
    }
    set form(value) {
        this._form = value;
    }
    get formHandler() {
        return this._formHandler;
    }
    set formHandler(value) {
        this._formHandler = value;
    }
    get url() {
        return this._url;
    }
    set url(value) {
        this._url = value;
    }
    get tooltip() {
        return this._tooltip;
    }
    set tooltip(value) {
        this._tooltip = value;
    }
    fromJson(modelElement) {
        super.fromJson(modelElement);
        // general attributes
        this.type = "button";
        this.setIcon(modelElement["icon"]);
        if (modelElement["color"] != null) {
            const color = modelElement["color"];
            if (typeof color === "object") {
                this._cssStyle = color;
            }
            else if (typeof color === "string") {
                if (ColorUtility.isPathDefaultColor(color)) {
                    this._cssClass = "tile-" + color;
                }
                else {
                    this._cssClass = color;
                }
            }
        }
        if (modelElement["form"] != null) {
            this.setForm(modelElement["form"]["form"]);
            this.setFormHandler(modelElement["form"]["handler"]);
        }
        this.setPage(modelElement["page"]);
        if (this.key == null && this.parentPageElement != null && modelElement.type === "button") {
            this.key = this.parentPageElement.key;
        }
        this.name = this.translationService.getText(modelElement["name"]);
        this.url = KeyUtility.translateUrl(modelElement["url"], null, false, this);
        if (modelElement["tooltip"] != null) {
            this.tooltip = this.translationService.getText(modelElement["tooltip"]);
        }
        // button details
        if (modelElement["details"] != null) {
            this.details = [];
            for (const detail of modelElement["details"]) {
                const bd = new ButtonDetail();
                bd.text = detail;
                this.details.push(bd);
            }
        }
        // button target
        this._cssButtonTarget = true;
        if (this.type === "button") {
            if (StringUtility.isEmpty(this.form) && StringUtility.isEmpty(this.page) && StringUtility.isEmpty(this.url)) {
                this._cssButtonTarget = false;
            }
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnV0dG9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3BhdGgtZnJhbWV3b3JrLyIsInNvdXJjZXMiOlsicGF0aC1mcmFtZXdvcmsvcGFnZS9lbGVtZW50L2J1dHRvbi9idXR0b24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQU0sV0FBVyxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFHakQsT0FBTyxFQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBRXZELE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSw4QkFBOEIsQ0FBQztBQUN4RCxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDN0MsT0FBTyxFQUFDLGFBQWEsRUFBQyxNQUFNLGlDQUFpQyxDQUFDO0FBQzlELE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxnQ0FBZ0MsQ0FBQztBQU01RCxJQUFhLGVBQWUsR0FBNUIsTUFBYSxlQUFlO0NBSTNCLENBQUE7QUFERztJQUZDLEtBQUssQ0FBQyxRQUFRLENBQUM7SUFDZixNQUFNLENBQUMsUUFBUSxDQUFDOytDQUNGO0FBSE4sZUFBZTtJQUozQixTQUFTLENBQUM7UUFDUCxRQUFRLEVBQUUsYUFBYTtRQUN2QixtMEJBQW9DO0tBQ3ZDLENBQUM7R0FDVyxlQUFlLENBSTNCO1NBSlksZUFBZTtBQU01QixNQUFNLE9BQU8sTUFBTyxTQUFRLFdBQVc7SUFnQm5DLFlBQVksR0FBYSxFQUFZLFdBQXdCLEVBQVksa0JBQXNDO1FBQzNHLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQURzQixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUFZLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7UUFUdkcsYUFBUSxHQUFtQixFQUFFLENBQUM7SUFXdEMsQ0FBQztJQUVNLE9BQU87UUFDVixJQUFJLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxFQUFFO1lBQ3ZC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Q2pDLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztTQUMzRTtRQUNELGlCQUFpQjtRQUNqQixJQUFJLFlBQVksQ0FBQyxTQUFTLENBQUMsSUFBSSxJQUFJLEVBQUU7WUFDakMsSUFBSSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7WUFDbEIsS0FBSyxNQUFNLE1BQU0sSUFBSSxZQUFZLENBQUMsU0FBUyxDQUFDLEVBQUU7Z0JBQzFDLE1BQU0sRUFBRSxHQUFpQixJQUFJLFlBQVksRUFBRSxDQUFDO2dCQUM1QyxFQUFFLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQztnQkFDakIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7YUFDekI7U0FDSjtRQUNELGdCQUFnQjtRQUNoQixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDO1FBQzdCLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxRQUFRLEVBQUU7WUFDeEIsSUFBSSxhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRTtnQkFDekcsSUFBSSxDQUFDLGdCQUFnQixHQUFHLEtBQUssQ0FBQzthQUNqQztTQUNKO0lBQ0wsQ0FBQztDQUNKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtLZXksIFBhZ2VFbGVtZW50fSBmcm9tIFwiLi4vcGFnZS1lbGVtZW50XCI7XHJcbmltcG9ydCB7UGF0aFNlcnZpY2V9IGZyb20gXCIuLi8uLi8uLi9zZXJ2aWNlL3BhdGguc2VydmljZVwiO1xyXG5pbXBvcnQge0lCdXR0b24sIElCdXR0b25IYW5kbGVyLCBJUGF0aEFwcH0gZnJvbSBcIi4uLy4uLy4uL3BhdGhpbnRlcmZhY2VcIjtcclxuaW1wb3J0IHtJbnB1dCwgT3V0cHV0LCBDb21wb25lbnR9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7VHJhbnNsYXRpb25TZXJ2aWNlfSBmcm9tIFwiLi4vLi4vLi4vc2VydmljZS90cmFuc2xhdGlvbi5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7S2V5VXRpbGl0eX0gZnJvbSBcIi4uLy4uLy4uL3V0aWxpdHkva2V5LXV0aWxpdHlcIjtcclxuaW1wb3J0IHtCdXR0b25EZXRhaWx9IGZyb20gXCIuL2J1dHRvbi1kZXRhaWxcIjtcclxuaW1wb3J0IHtTdHJpbmdVdGlsaXR5fSBmcm9tIFwiLi4vLi4vLi4vdXRpbGl0eS9zdHJpbmctdXRpbGl0eVwiO1xyXG5pbXBvcnQge0NvbG9yVXRpbGl0eX0gZnJvbSBcIi4uLy4uLy4uL3V0aWxpdHkvY29sb3ItdXRpbGl0eVwiO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogXCJwYXRoLWJ1dHRvblwiLFxyXG4gICAgdGVtcGxhdGVVcmw6IFwiYnV0dG9uLmNvbXBvbmVudC5odG1sXCJcclxufSlcclxuZXhwb3J0IGNsYXNzIEJ1dHRvbkNvbXBvbmVudCB7XHJcbiAgICBASW5wdXQoXCJidXR0b25cIilcclxuICAgIEBPdXRwdXQoXCJidXR0b25cIilcclxuICAgIGJ1dHRvbjogQnV0dG9uO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQnV0dG9uIGV4dGVuZHMgUGFnZUVsZW1lbnQgaW1wbGVtZW50cyBJQnV0dG9uIHtcclxuICAgIHByaXZhdGUgX2ljb246IHN0cmluZztcclxuICAgIHByaXZhdGUgX2Nzc1N0eWxlOiBPYmplY3Q7XHJcbiAgICBwcml2YXRlIF9jc3NDbGFzczogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSBfY3NzQnV0dG9uVGFyZ2V0OiBib29sZWFuO1xyXG4gICAgcHJpdmF0ZSBfY3NzR3JvdXBCb3JkZXI6IHN0cmluZztcclxuICAgIHByaXZhdGUgX2hhbmRsZXI6IElCdXR0b25IYW5kbGVyO1xyXG4gICAgcHJpdmF0ZSBfZGV0YWlsczogQnV0dG9uRGV0YWlsW10gPSBbXTtcclxuICAgIHByaXZhdGUgX3Rvb2x0aXA6IHN0cmluZztcclxuXHJcbiAgICAvLyBUT0RPIHJlZmFjdG9yIHByb3RvdHlwZSBzdHVmZlxyXG4gICAgcHJpdmF0ZSBfdXJsOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF9wYWdlOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF9mb3JtOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF9mb3JtSGFuZGxlcjogc3RyaW5nO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGFwcDogSVBhdGhBcHAsIHByb3RlY3RlZCBwYXRoU2VydmljZTogUGF0aFNlcnZpY2UsIHByb3RlY3RlZCB0cmFuc2xhdGlvblNlcnZpY2U6IFRyYW5zbGF0aW9uU2VydmljZSkge1xyXG4gICAgICAgIHN1cGVyKGFwcCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG9uQ2xpY2soKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2hhbmRsZXIgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVyLmRvQ2xpY2sodGhpcyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghU3RyaW5nVXRpbGl0eS5pc0VtcHR5KHRoaXMuX3VybCkpIHtcclxuICAgICAgICAgICAgdGhpcy5wYXRoU2VydmljZS5zZXJ2ZXJHZXQodGhpcy5hcHAuZ2V0QmFja2VuZFVybCgpLCB0aGlzLl91cmwsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYXBwLnJlZnJlc2hDdXJyZW50UGFnZSgpO1xyXG4gICAgICAgICAgICB9LCBudWxsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghU3RyaW5nVXRpbGl0eS5pc0VtcHR5KHRoaXMuX3BhZ2UpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwLnNldEN1cnJlbnRQYWdlKHRoaXMuX3BhZ2UsIHRoaXMpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIVN0cmluZ1V0aWxpdHkuaXNFbXB0eSh0aGlzLl9mb3JtKSkge1xyXG4gICAgICAgICAgICB0aGlzLmFwcC5zZXRDdXJyZW50Rm9ybSh0aGlzLl9mb3JtLCB0aGlzLmtleSwgdGhpcy5fZm9ybUhhbmRsZXIsIHRoaXMpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXRJY29uKGljb246IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuaWNvbiA9IGljb247XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldEZvcm0oZm9ybTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5mb3JtID0gZm9ybTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0Rm9ybUhhbmRsZXIoZm9ybUhhbmRsZXI6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuZm9ybUhhbmRsZXIgPSBmb3JtSGFuZGxlcjtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0UGFnZShwYWdlOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLnBhZ2UgPSBwYWdlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXRLZXkoa2V5OiBLZXkpIHtcclxuICAgICAgICB0aGlzLmtleSA9IGtleTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0QXBwKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmFwcDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0TmFtZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5uYW1lO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpY29uKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ljb247XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGljb24odmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuX2ljb24gPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgY3NzU3R5bGUoKTogT2JqZWN0IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY3NzU3R5bGU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGNzc0NsYXNzKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Nzc0NsYXNzO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjc3NCdXR0b25UYXJnZXQoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Nzc0J1dHRvblRhcmdldDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgY3NzR3JvdXBCb3JkZXIoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY3NzR3JvdXBCb3JkZXI7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGNzc0dyb3VwQm9yZGVyKHZhbHVlOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLl9jc3NHcm91cEJvcmRlciA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBoYW5kbGVyKCk6IElCdXR0b25IYW5kbGVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faGFuZGxlcjtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgaGFuZGxlcih2YWx1ZTogSUJ1dHRvbkhhbmRsZXIpIHtcclxuICAgICAgICB0aGlzLl9oYW5kbGVyID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGRldGFpbHMoKTogQnV0dG9uRGV0YWlsW10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9kZXRhaWxzO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBkZXRhaWxzKHZhbHVlOiBCdXR0b25EZXRhaWxbXSkge1xyXG4gICAgICAgIHRoaXMuX2RldGFpbHMgPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgcGFnZSgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wYWdlO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBwYWdlKHZhbHVlOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLl9wYWdlID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGZvcm0oKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZm9ybTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgZm9ybSh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5fZm9ybSA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBmb3JtSGFuZGxlcigpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9mb3JtSGFuZGxlcjtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgZm9ybUhhbmRsZXIodmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuX2Zvcm1IYW5kbGVyID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHVybCgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl91cmw7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHVybCh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5fdXJsID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHRvb2x0aXAoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdG9vbHRpcDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgdG9vbHRpcCh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5fdG9vbHRpcCA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBmcm9tSnNvbihtb2RlbEVsZW1lbnQpIHtcclxuICAgICAgICBzdXBlci5mcm9tSnNvbihtb2RlbEVsZW1lbnQpO1xyXG5cclxuICAgICAgICAvLyBnZW5lcmFsIGF0dHJpYnV0ZXNcclxuICAgICAgICB0aGlzLnR5cGUgPSBcImJ1dHRvblwiO1xyXG4gICAgICAgIHRoaXMuc2V0SWNvbihtb2RlbEVsZW1lbnRbXCJpY29uXCJdKTtcclxuICAgICAgICBpZiAobW9kZWxFbGVtZW50W1wiY29sb3JcIl0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBjb25zdCBjb2xvciA9IG1vZGVsRWxlbWVudFtcImNvbG9yXCJdO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbG9yID09PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jc3NTdHlsZSA9IGNvbG9yO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBjb2xvciA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgaWYgKENvbG9yVXRpbGl0eS5pc1BhdGhEZWZhdWx0Q29sb3IoY29sb3IpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3NzQ2xhc3MgPSBcInRpbGUtXCIgKyBjb2xvcjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3NzQ2xhc3MgPSBjb2xvcjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobW9kZWxFbGVtZW50W1wiZm9ybVwiXSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Rm9ybShtb2RlbEVsZW1lbnRbXCJmb3JtXCJdW1wiZm9ybVwiXSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Rm9ybUhhbmRsZXIobW9kZWxFbGVtZW50W1wiZm9ybVwiXVtcImhhbmRsZXJcIl0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNldFBhZ2UobW9kZWxFbGVtZW50W1wicGFnZVwiXSk7XHJcbiAgICAgICAgaWYgKHRoaXMua2V5ID09IG51bGwgJiYgdGhpcy5wYXJlbnRQYWdlRWxlbWVudCAhPSBudWxsICYmIG1vZGVsRWxlbWVudC50eXBlID09PSBcImJ1dHRvblwiKSB7XHJcbiAgICAgICAgICAgIHRoaXMua2V5ID0gdGhpcy5wYXJlbnRQYWdlRWxlbWVudC5rZXk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubmFtZSA9IHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLmdldFRleHQobW9kZWxFbGVtZW50W1wibmFtZVwiXSk7XHJcbiAgICAgICAgdGhpcy51cmwgPSBLZXlVdGlsaXR5LnRyYW5zbGF0ZVVybChtb2RlbEVsZW1lbnRbXCJ1cmxcIl0sIG51bGwsIGZhbHNlLCB0aGlzKTtcclxuICAgICAgICBpZiAobW9kZWxFbGVtZW50W1widG9vbHRpcFwiXSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMudG9vbHRpcCA9IHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLmdldFRleHQobW9kZWxFbGVtZW50W1widG9vbHRpcFwiXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGJ1dHRvbiBkZXRhaWxzXHJcbiAgICAgICAgaWYgKG1vZGVsRWxlbWVudFtcImRldGFpbHNcIl0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLmRldGFpbHMgPSBbXTtcclxuICAgICAgICAgICAgZm9yIChjb25zdCBkZXRhaWwgb2YgbW9kZWxFbGVtZW50W1wiZGV0YWlsc1wiXSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYmQ6IEJ1dHRvbkRldGFpbCA9IG5ldyBCdXR0b25EZXRhaWwoKTtcclxuICAgICAgICAgICAgICAgIGJkLnRleHQgPSBkZXRhaWw7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRldGFpbHMucHVzaChiZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gYnV0dG9uIHRhcmdldFxyXG4gICAgICAgIHRoaXMuX2Nzc0J1dHRvblRhcmdldCA9IHRydWU7XHJcbiAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gXCJidXR0b25cIikge1xyXG4gICAgICAgICAgICBpZiAoU3RyaW5nVXRpbGl0eS5pc0VtcHR5KHRoaXMuZm9ybSkgJiYgU3RyaW5nVXRpbGl0eS5pc0VtcHR5KHRoaXMucGFnZSkgJiYgU3RyaW5nVXRpbGl0eS5pc0VtcHR5KHRoaXMudXJsKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3NzQnV0dG9uVGFyZ2V0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19