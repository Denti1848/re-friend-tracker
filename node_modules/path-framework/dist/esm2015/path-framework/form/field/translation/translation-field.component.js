import * as tslib_1 from "tslib";
import { Component, Input, Output } from "@angular/core";
import { ValueField } from "../value-field";
import { FormFunction } from "../../form-function";
import { Form } from "../../form.component";
import { OkButton } from "../button/ok-button";
import { CancelButton } from "../button/cancel-button";
import { TextField } from "../text/text-field.component";
import { FocusUtility } from "../../focus-utility";
let TranslationFieldComponent = class TranslationFieldComponent {
};
tslib_1.__decorate([
    Input("field"),
    Output("field")
], TranslationFieldComponent.prototype, "field", void 0);
TranslationFieldComponent = tslib_1.__decorate([
    Component({
        selector: "path-translationfield",
        template: "<path-form-field-label [label]=\"field.name\" [required]=\"field.required\"></path-form-field-label>\r\n<div [class.col-md-4]=\"field.width == 1\" [class.col-md-10]=\"field.width == 2\">\r\n    <div class=\"input-group\">\r\n        <input *ngIf=\"field.height == null || field.height <= 1\" #model=\"ngModel\" readonly-with-required (keydown)=\"field.editTranslations()\" (click)=\"field.editTranslations()\" [class.required-field]=\"!model.valid && !model.pristine && field.required\" [required]=\"field.required\" [(ngModel)]=\"field.defaultTranslation\" type=\"text\" class=\"form-control\" placeholder=\"\">\r\n        <textarea *ngIf=\"field.height != null && field.height > 1\" #model=\"ngModel\" readonly-with-required (keydown)=\"field.editTranslations()\" (click)=\"field.editTranslations()\" [class.required-field]=\"(!model.valid &&!model.pristine && field.required)\" [required]=\"field.required\" [(ngModel)]=field.defaultTranslation rows=\"{{field.height}}\" type=\"text\" class=\"form-control\" placeholder=\"\"></textarea>\r\n        <span class=\"input-group-btn\">\r\n                <button [disabled]=\"field.isReadonly()\" (click)=\"field.editTranslations()\" class=\"btn btn-default\" type=\"button\">{{field.translationLabel}}...</button>\r\n        </span>\r\n    </div>\r\n</div>\r\n"
    })
], TranslationFieldComponent);
export { TranslationFieldComponent };
export class TranslationField extends ValueField {
    constructor(form, pathService, translationService) {
        super(form, translationService);
        this.pathService = pathService;
        this.translationService = translationService;
        this._defaultTranslation = null;
        this.userLanguage = translationService.getUserLanguage();
        this.languages = translationService.getSupportedLanguageCodes();
        const initialList = [];
        for (const language of this.languages) {
            initialList.push([{ "key": language }, ""]);
        }
        this.setValue(initialList);
        this._translationLabel = translationService.getText("Translation");
    }
    get defaultTranslation() {
        return this._defaultTranslation;
    }
    set defaultTranslation(value) {
        this._defaultTranslation = value;
    }
    get translationLabel() {
        return this._translationLabel;
    }
    setValue(value) {
        super.setValue(value);
        this._defaultTranslation = this.getDefaultTranslation();
    }
    getDefaultTranslation() {
        if (this.value != null) {
            for (const item of this.value) {
                if (item[0] != null && item[0]["key"] === this.userLanguage) {
                    return item[1];
                }
            }
        }
        return null;
    }
    editTranslations() {
        const form = new Form(this.pathService, this.form.getApp());
        const translationFields = [];
        form.title = this.name + " " + this.translationService.getText("Translations");
        form.formFunction = new FormFunction();
        form.formFunction.save = (data) => {
            const resultList = [];
            for (const field of translationFields) {
                resultList.push([{ "key": field.id }, field.value]);
            }
            this.setValue(resultList);
            this.getForm().getApp().closeCurrentForm();
        };
        form.formFunction.cancel = () => {
            this.getForm().getApp().closeCurrentForm();
        };
        const translations = this.value;
        for (const key of translations) {
            const textField = new TextField(form, this.translationService);
            textField.type = "text";
            textField.id = key[0]["key"];
            textField.name = this.translationService.getText(key[0]["key"]);
            textField.visible = true;
            textField.newRow = true;
            textField.width = 2;
            textField.height = this.height;
            textField.labelVisible = true;
            textField.required = true;
            textField.setValue(key[1]);
            form.fields.push(textField);
            translationFields.push(textField);
        }
        const cancelButton = new CancelButton(form, this.translationService);
        cancelButton.type = "cancelButton";
        cancelButton.name = this.translationService.getText("Cancel");
        cancelButton.visible = true;
        form.fields.push(cancelButton);
        const okButton = new OkButton(form, this.translationService);
        okButton.type = "okButton";
        okButton.name = this.translationService.getText("Ok");
        okButton.visible = true;
        form.fields.push(okButton);
        form.updateRows();
        this.form.getApp()["_formStack"].push(form); // TODO
        FocusUtility.focusFirstField(form);
    }
}
export class TranslationEntry {
    get text() {
        return this._text;
    }
    set text(value) {
        this._text = value;
    }
    get code() {
        return this._code;
    }
    set code(value) {
        this._code = value;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNsYXRpb24tZmllbGQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vcGF0aC1mcmFtZXdvcmsvIiwic291cmNlcyI6WyJwYXRoLWZyYW1ld29yay9mb3JtL2ZpZWxkL3RyYW5zbGF0aW9uL3RyYW5zbGF0aW9uLWZpZWxkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ3ZELE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUMxQyxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0scUJBQXFCLENBQUM7QUFDakQsT0FBTyxFQUFDLElBQUksRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBQzFDLE9BQU8sRUFBQyxRQUFRLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQUM3QyxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0seUJBQXlCLENBQUM7QUFFckQsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLDhCQUE4QixDQUFDO0FBRXZELE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQU1qRCxJQUFhLHlCQUF5QixHQUF0QyxNQUFhLHlCQUF5QjtDQUlyQyxDQUFBO0FBREc7SUFGQyxLQUFLLENBQUMsT0FBTyxDQUFDO0lBQ2QsTUFBTSxDQUFDLE9BQU8sQ0FBQzt3REFDUTtBQUhmLHlCQUF5QjtJQUpyQyxTQUFTLENBQUM7UUFDUCxRQUFRLEVBQUUsdUJBQXVCO1FBQ2pDLHl5Q0FBK0M7S0FDbEQsQ0FBQztHQUNXLHlCQUF5QixDQUlyQztTQUpZLHlCQUF5QjtBQU10QyxNQUFNLE9BQU8sZ0JBQWlCLFNBQVEsVUFBbUI7SUFPckQsWUFBWSxJQUFVLEVBQVUsV0FBd0IsRUFBUyxrQkFBc0M7UUFDbkcsS0FBSyxDQUFDLElBQUksRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1FBREosZ0JBQVcsR0FB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bXBvcnQge0NvbXBvbmVudCwgSW5wdXQsIE91dHB1dH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHtWYWx1ZUZpZWxkfSBmcm9tIFwiLi4vdmFsdWUtZmllbGRcIjtcclxuaW1wb3J0IHtGb3JtRnVuY3Rpb259IGZyb20gXCIuLi8uLi9mb3JtLWZ1bmN0aW9uXCI7XHJcbmltcG9ydCB7Rm9ybX0gZnJvbSBcIi4uLy4uL2Zvcm0uY29tcG9uZW50XCI7XHJcbmltcG9ydCB7T2tCdXR0b259IGZyb20gXCIuLi9idXR0b24vb2stYnV0dG9uXCI7XHJcbmltcG9ydCB7Q2FuY2VsQnV0dG9ufSBmcm9tIFwiLi4vYnV0dG9uL2NhbmNlbC1idXR0b25cIjtcclxuaW1wb3J0IHtQYXRoU2VydmljZX0gZnJvbSBcIi4uLy4uLy4uL3NlcnZpY2UvcGF0aC5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7VGV4dEZpZWxkfSBmcm9tIFwiLi4vdGV4dC90ZXh0LWZpZWxkLmNvbXBvbmVudFwiO1xyXG5pbXBvcnQge1RyYW5zbGF0aW9uU2VydmljZX0gZnJvbSBcIi4uLy4uLy4uL3NlcnZpY2UvdHJhbnNsYXRpb24uc2VydmljZVwiO1xyXG5pbXBvcnQge0ZvY3VzVXRpbGl0eX0gZnJvbSBcIi4uLy4uL2ZvY3VzLXV0aWxpdHlcIjtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6IFwicGF0aC10cmFuc2xhdGlvbmZpZWxkXCIsXHJcbiAgICB0ZW1wbGF0ZVVybDogXCJ0cmFuc2xhdGlvbi1maWVsZC5jb21wb25lbnQuaHRtbFwiXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBUcmFuc2xhdGlvbkZpZWxkQ29tcG9uZW50IHtcclxuICAgIEBJbnB1dChcImZpZWxkXCIpXHJcbiAgICBAT3V0cHV0KFwiZmllbGRcIilcclxuICAgIGZpZWxkOiBUcmFuc2xhdGlvbkZpZWxkO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgVHJhbnNsYXRpb25GaWVsZCBleHRlbmRzIFZhbHVlRmllbGQ8YW55W11bXT4ge1xyXG5cclxuICAgIHByaXZhdGUgbGFuZ3VhZ2VzOiBzdHJpbmdbXTtcclxuICAgIHByaXZhdGUgdXNlckxhbmd1YWdlOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF9kZWZhdWx0VHJhbnNsYXRpb246IHN0cmluZyA9IG51bGw7XHJcbiAgICBwcml2YXRlIF90cmFuc2xhdGlvbkxhYmVsOiBzdHJpbmc7XHJcblxyXG4gICAgY29uc3RydWN0b3IoZm9ybTogRm9ybSwgcHJpdmF0ZSBwYXRoU2VydmljZTogUGF0aFNlcnZpY2UsIHB1YmxpYyB0cmFuc2xhdGlvblNlcnZpY2U6IFRyYW5zbGF0aW9uU2VydmljZSkge1xyXG4gICAgICAgIHN1cGVyKGZvcm0sIHRyYW5zbGF0aW9uU2VydmljZSk7XHJcbiAgICAgICAgdGhpcy51c2VyTGFuZ3VhZ2UgPSB0cmFuc2xhdGlvblNlcnZpY2UuZ2V0VXNlckxhbmd1YWdlKCk7XHJcbiAgICAgICAgdGhpcy5sYW5ndWFnZXMgPSB0cmFuc2xhdGlvblNlcnZpY2UuZ2V0U3VwcG9ydGVkTGFuZ3VhZ2VDb2RlcygpO1xyXG4gICAgICAgIGNvbnN0IGluaXRpYWxMaXN0OiBhbnlbXVtdID0gW107XHJcbiAgICAgICAgZm9yIChjb25zdCBsYW5ndWFnZSBvZiB0aGlzLmxhbmd1YWdlcykge1xyXG4gICAgICAgICAgICBpbml0aWFsTGlzdC5wdXNoKFt7XCJrZXlcIjogbGFuZ3VhZ2V9LCBcIlwiXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2V0VmFsdWUoaW5pdGlhbExpc3QpO1xyXG4gICAgICAgIHRoaXMuX3RyYW5zbGF0aW9uTGFiZWwgPSB0cmFuc2xhdGlvblNlcnZpY2UuZ2V0VGV4dChcIlRyYW5zbGF0aW9uXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBkZWZhdWx0VHJhbnNsYXRpb24oKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZGVmYXVsdFRyYW5zbGF0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBkZWZhdWx0VHJhbnNsYXRpb24odmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuX2RlZmF1bHRUcmFuc2xhdGlvbiA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB0cmFuc2xhdGlvbkxhYmVsKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RyYW5zbGF0aW9uTGFiZWw7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldFZhbHVlKHZhbHVlOiBhbnlbXVtdKSB7XHJcbiAgICAgICAgc3VwZXIuc2V0VmFsdWUodmFsdWUpO1xyXG4gICAgICAgIHRoaXMuX2RlZmF1bHRUcmFuc2xhdGlvbiA9IHRoaXMuZ2V0RGVmYXVsdFRyYW5zbGF0aW9uKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXREZWZhdWx0VHJhbnNsYXRpb24oKTogc3RyaW5nIHtcclxuICAgICAgICBpZiAodGhpcy52YWx1ZSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbVswXSAhPSBudWxsICYmIGl0ZW1bMF1bXCJrZXlcIl0gPT09IHRoaXMudXNlckxhbmd1YWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1bMV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGVkaXRUcmFuc2xhdGlvbnMoKSB7XHJcbiAgICAgICAgY29uc3QgZm9ybTogRm9ybSA9IG5ldyBGb3JtKHRoaXMucGF0aFNlcnZpY2UsIHRoaXMuZm9ybS5nZXRBcHAoKSk7XHJcbiAgICAgICAgY29uc3QgdHJhbnNsYXRpb25GaWVsZHM6IFRleHRGaWVsZFtdID0gW107XHJcbiAgICAgICAgZm9ybS50aXRsZSA9IHRoaXMubmFtZSArIFwiIFwiICsgdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuZ2V0VGV4dChcIlRyYW5zbGF0aW9uc1wiKTtcclxuICAgICAgICBmb3JtLmZvcm1GdW5jdGlvbiA9IG5ldyBGb3JtRnVuY3Rpb24oKTtcclxuICAgICAgICBmb3JtLmZvcm1GdW5jdGlvbi5zYXZlID0gKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHRMaXN0OiBhbnlbXVtdID0gW107XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgZmllbGQgb2YgdHJhbnNsYXRpb25GaWVsZHMpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdExpc3QucHVzaChbe1wia2V5XCI6IGZpZWxkLmlkfSwgZmllbGQudmFsdWVdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnNldFZhbHVlKHJlc3VsdExpc3QpO1xyXG4gICAgICAgICAgICB0aGlzLmdldEZvcm0oKS5nZXRBcHAoKS5jbG9zZUN1cnJlbnRGb3JtKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBmb3JtLmZvcm1GdW5jdGlvbi5jYW5jZWwgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0Rm9ybSgpLmdldEFwcCgpLmNsb3NlQ3VycmVudEZvcm0oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IHRyYW5zbGF0aW9ucyA9IHRoaXMudmFsdWU7XHJcbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgdHJhbnNsYXRpb25zKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRleHRGaWVsZDogVGV4dEZpZWxkID0gbmV3IFRleHRGaWVsZChmb3JtLCB0aGlzLnRyYW5zbGF0aW9uU2VydmljZSk7XHJcbiAgICAgICAgICAgIHRleHRGaWVsZC50eXBlID0gXCJ0ZXh0XCI7XHJcbiAgICAgICAgICAgIHRleHRGaWVsZC5pZCA9IGtleVswXVtcImtleVwiXTtcclxuICAgICAgICAgICAgdGV4dEZpZWxkLm5hbWUgPSB0aGlzLnRyYW5zbGF0aW9uU2VydmljZS5nZXRUZXh0KGtleVswXVtcImtleVwiXSk7XHJcbiAgICAgICAgICAgIHRleHRGaWVsZC52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGV4dEZpZWxkLm5ld1JvdyA9IHRydWU7XHJcbiAgICAgICAgICAgIHRleHRGaWVsZC53aWR0aCA9IDI7XHJcbiAgICAgICAgICAgIHRleHRGaWVsZC5oZWlnaHQgPSB0aGlzLmhlaWdodDtcclxuICAgICAgICAgICAgdGV4dEZpZWxkLmxhYmVsVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHRleHRGaWVsZC5yZXF1aXJlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHRleHRGaWVsZC5zZXRWYWx1ZShrZXlbMV0pO1xyXG4gICAgICAgICAgICBmb3JtLmZpZWxkcy5wdXNoKHRleHRGaWVsZCk7XHJcbiAgICAgICAgICAgIHRyYW5zbGF0aW9uRmllbGRzLnB1c2godGV4dEZpZWxkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNhbmNlbEJ1dHRvbjogQ2FuY2VsQnV0dG9uID0gbmV3IENhbmNlbEJ1dHRvbihmb3JtLCB0aGlzLnRyYW5zbGF0aW9uU2VydmljZSk7XHJcbiAgICAgICAgY2FuY2VsQnV0dG9uLnR5cGUgPSBcImNhbmNlbEJ1dHRvblwiO1xyXG4gICAgICAgIGNhbmNlbEJ1dHRvbi5uYW1lID0gdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuZ2V0VGV4dChcIkNhbmNlbFwiKTtcclxuICAgICAgICBjYW5jZWxCdXR0b24udmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgZm9ybS5maWVsZHMucHVzaChjYW5jZWxCdXR0b24pO1xyXG5cclxuICAgICAgICBjb25zdCBva0J1dHRvbjogT2tCdXR0b24gPSBuZXcgT2tCdXR0b24oZm9ybSwgdGhpcy50cmFuc2xhdGlvblNlcnZpY2UpO1xyXG4gICAgICAgIG9rQnV0dG9uLnR5cGUgPSBcIm9rQnV0dG9uXCI7XHJcbiAgICAgICAgb2tCdXR0b24ubmFtZSA9IHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLmdldFRleHQoXCJPa1wiKTtcclxuICAgICAgICBva0J1dHRvbi52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICBmb3JtLmZpZWxkcy5wdXNoKG9rQnV0dG9uKTtcclxuXHJcbiAgICAgICAgZm9ybS51cGRhdGVSb3dzKCk7XHJcblxyXG4gICAgICAgIHRoaXMuZm9ybS5nZXRBcHAoKVtcIl9mb3JtU3RhY2tcIl0ucHVzaChmb3JtKTsgLy8gVE9ET1xyXG4gICAgICAgIEZvY3VzVXRpbGl0eS5mb2N1c0ZpcnN0RmllbGQoZm9ybSk7XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgVHJhbnNsYXRpb25FbnRyeSB7XHJcbiAgICBwcml2YXRlIF90ZXh0OiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF9jb2RlOiBzdHJpbmc7XHJcblxyXG4gICAgZ2V0IHRleHQoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdGV4dDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgdGV4dCh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5fdGV4dCA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjb2RlKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvZGU7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGNvZGUodmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuX2NvZGUgPSB2YWx1ZTtcclxuICAgIH1cclxufVxyXG4iXX0=