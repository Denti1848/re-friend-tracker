import * as tslib_1 from "tslib";
import { Component, Input, Output } from "@angular/core";
import { PageElement } from "../page-element";
import { KeyUtility } from "../../../utility/key-utility";
import { Button } from "../button/button.component";
import { FocusUtility } from "../../../form/focus-utility";
import { Subject } from "rxjs";
import { debounceTime } from "rxjs/operators";
var ListComponent = /** @class */ (function () {
    function ListComponent() {
    }
    ListComponent.prototype.ngAfterViewInit = function () {
        FocusUtility.focusFirstField(null);
    };
    tslib_1.__decorate([
        Input("list"),
        Output("list")
    ], ListComponent.prototype, "list", void 0);
    ListComponent = tslib_1.__decorate([
        Component({
            selector: "path-list",
            template: "<!-- search on mobile devices -->\r\n<div *ngIf='list.search' class=\"search-mobile hide-on-desktop\">\r\n    <div class=\"row\">\r\n        <label for=\"search-mobile\">Search</label>\r\n        <input id=\"search-mobile\" name=\"search\" [(ngModel)]=\"list.searchText\" placeholder=\"{{list.searchInputLabel}}\" (ngModelChange)='list.filterChanged($event)' class=\"form-control\" type=\"text\">\r\n    </div>\r\n</div>\r\n<span>\r\n    <span>\r\n        <div class=\"tile-group\">\r\n            <!-- default search (tablet, desktop) -->\r\n            <div *ngIf='list.search' class=\"thumbnail {{(list.searchButton.width <= 1 ? 'tile-medium' : (list.searchButton.width == 2 ? 'tile-wide' : (list.searchButton.width == 3 ? 'tile-wide-3' : (list.searchButton.width >= 4 ? 'tile-wide-4' : ''))))}} tile tile-button hide-on-mobile {{list.searchButton.cssClass}}\" [ngStyle]=\"list.searchButton.cssStyle\">\r\n                <div class=\"input-group input-group-sm\">\r\n                    <div class=\"h3\">{{list.searchLabel}}</div>\r\n                    <i class=\"fa fa-2x fa-search\"></i>\r\n                    <div class=\"h5\"></div>\r\n                    <form>\r\n                        <input name=\"search\" [(ngModel)]=\"list.searchText\" placeholder=\"{{list.searchInputLabel}}\" (ngModelChange)='list.filterChanged($event)' class=\"form-control\" type=\"text\">\r\n                    </form>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </span>\r\n    <!-- list -->\r\n    <span *ngFor='let buttonGroup of list.buttonGroups; let i = index'>\r\n        <path-button-group [buttonGroup]=\"buttonGroup\"></path-button-group>\r\n    </span>\r\n</span>"
        })
    ], ListComponent);
    return ListComponent;
}());
export { ListComponent };
var List = /** @class */ (function (_super) {
    tslib_1.__extends(List, _super);
    function List(app, pathService, translationService) {
        var _this = _super.call(this, app) || this;
        _this.pathService = pathService;
        _this.translationService = translationService;
        _this._buttonGroups = [];
        _this._searchTextChanged = new Subject();
        _this._searchLabel = translationService.getText("Search");
        _this._searchInputLabel = translationService.getText("SearchInputLabel");
        _this._searchButton = new Button(app, pathService, translationService);
        return _this;
    }
    List.prototype.getContent = function () {
        var e_1, _a;
        var buttons = [];
        try {
            for (var _b = tslib_1.__values(this.buttonGroups), _c = _b.next(); !_c.done; _c = _b.next()) {
                var buttonGroup = _c.value;
                buttons.push.apply(buttons, tslib_1.__spread(buttonGroup.buttons));
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return buttons;
    };
    List.prototype.refresh = function (searchText, afterRefreshHandler) {
        var e_2, _a;
        var _this = this;
        // callback function for data
        console.log("refresh list (searchText: " + searchText + ")");
        var dataHandler = function (data) {
            var e_3, _a, e_4, _b, e_5, _c;
            _this.buttonGroups = [];
            try {
                for (var data_1 = tslib_1.__values(data), data_1_1 = data_1.next(); !data_1_1.done; data_1_1 = data_1.next()) {
                    var item = data_1_1.value;
                    // create button group and buttons
                    // set default types if server does not set type (button or buttonGroup)
                    var itemIsButtonGroup = item.hasOwnProperty("buttons");
                    if (itemIsButtonGroup) {
                        item["type"] = "buttonGroup";
                        try {
                            for (var _d = (e_4 = void 0, tslib_1.__values(item.buttons)), _e = _d.next(); !_e.done; _e = _d.next()) {
                                var button = _e.value;
                                if (button["type"] == null) {
                                    button["type"] = "button";
                                }
                            }
                        }
                        catch (e_4_1) { e_4 = { error: e_4_1 }; }
                        finally {
                            try {
                                if (_e && !_e.done && (_b = _d.return)) _b.call(_d);
                            }
                            finally { if (e_4) throw e_4.error; }
                        }
                    }
                    else {
                        if (item["type"] == null) {
                            item["type"] = "button";
                        }
                    }
                    var pageElements = _this.app.createPageElement(item, _this.parentPageElement, null);
                    if (pageElements.length !== 1) {
                        console.log("error creating button group from: ");
                        console.log(item);
                    }
                    else {
                        var buttonGroup = pageElements[0];
                        var buttonCounter = 0;
                        try {
                            for (var _f = (e_5 = void 0, tslib_1.__values(buttonGroup.buttons)), _g = _f.next(); !_g.done; _g = _f.next()) {
                                var button = _g.value;
                                button.listElement = true;
                                // model is either simple button or button of a group
                                var buttonModel = item;
                                if (itemIsButtonGroup) {
                                    buttonModel = item.buttons[buttonCounter];
                                }
                                // build button from json
                                // use list defaults if button does not specify model
                                if (buttonModel["icon"] == null) {
                                    buttonModel["icon"] = _this.icon;
                                }
                                if (buttonModel["color"] == null) {
                                    buttonModel["color"] = _this.color;
                                }
                                if (buttonModel["page"] == null && (buttonModel["form"] == null || buttonModel["form"]["form"] == null)) {
                                    // service does not return page or form, use static model
                                    if (_this.page != null) {
                                        buttonModel["page"] = _this.page;
                                    }
                                    if (_this.form != null) {
                                        buttonModel["form"] = {};
                                        buttonModel.form["form"] = _this.form;
                                        buttonModel.form["handler"] = _this.formHandler;
                                    }
                                }
                                // special default width (2 instead of 1) for buttons in list
                                if (buttonModel["width"] == null) {
                                    buttonModel["width"] = _this.width;
                                }
                                button.fromJson(buttonModel);
                                // special values for list buttons
                                button.handler = _this._buttonHandler;
                                button.name = buttonModel.name; // no translation
                                button.tooltip = buttonModel.tooltip; // no translation
                                buttonCounter++;
                            }
                        }
                        catch (e_5_1) { e_5 = { error: e_5_1 }; }
                        finally {
                            try {
                                if (_g && !_g.done && (_c = _f.return)) _c.call(_f);
                            }
                            finally { if (e_5) throw e_5.error; }
                        }
                        _this.buttonGroups.push(buttonGroup);
                    }
                }
            }
            catch (e_3_1) { e_3 = { error: e_3_1 }; }
            finally {
                try {
                    if (data_1_1 && !data_1_1.done && (_a = data_1.return)) _a.call(data_1);
                }
                finally { if (e_3) throw e_3.error; }
            }
            if (_this.handler != null) {
                _this.handler.doLoad(_this); // TODO useful?
            }
            // refresh search
            _this.filterVisibleButtonGroups();
            if (_this.limit) {
                _this.setSearchResultsCountMessage();
            }
            if (afterRefreshHandler != null) {
                window.setTimeout(function () {
                    afterRefreshHandler();
                }, 1);
            }
        };
        var listHandlerDoLoad = function (list) { return function (data) { return dataHandler(data); }; };
        // backend data
        if (this._url != null) {
            var urlParameters = "";
            if (this.searchRequest || this.limit) {
                urlParameters = "?search=" + (searchText == null ? "" : encodeURI(searchText)) + "&limit=" + this.limit;
            }
            this.pathService.serverGet(this.app.getBackendUrl(), this.url + urlParameters, listHandlerDoLoad(this), null);
        }
        // mock data
        if (this._mockData != null) {
            var count = 0;
            try {
                // fake a key for mock data
                for (var _b = tslib_1.__values(this.mockData), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var mock = _c.value;
                    count++;
                    if (mock["key"] == null) {
                        mock["key"] = count;
                    }
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_2) throw e_2.error; }
            }
            dataHandler(this.mockData);
        }
    };
    List.prototype.filterChanged = function (text) {
        this._searchTextChanged.next(text);
    };
    List.prototype.filter = function () {
        this._searchLabel = this.translationService.getText("Search");
        if (this._searchText && this._searchText === "*") {
            this.refresh(null, null);
        }
        else if (this.searchRequest) {
            // call server to filter data
            if (!this._searchText && this.searchRequired) {
                this._buttonGroups = [];
            }
            else if (this._searchText === "*" || (!this._searchText && !this.searchRequired)) {
                this.refresh(null, null);
            }
            else if (this._searchText && this._searchText.length >= 2) {
                this.refresh(this._searchText, null);
            }
            else {
                this._searchLabel = this.translationService.getText("SearchTextTooShort");
                this._buttonGroups = [];
            }
        }
        else {
            // filter loaded data only
            this.filterVisibleButtonGroups();
        }
    };
    List.prototype.filterVisibleButtonGroups = function () {
        var e_6, _a, e_7, _b, e_8, _c;
        var searchText = this._searchText ? this._searchText.toLowerCase() : "";
        try {
            for (var _d = tslib_1.__values(this._buttonGroups), _e = _d.next(); !_e.done; _e = _d.next()) {
                var buttonGroup = _e.value;
                if (searchText.length <= 0) {
                    buttonGroup.visible = true;
                }
                else {
                    buttonGroup.visible = false;
                    try {
                        for (var _f = (e_7 = void 0, tslib_1.__values(buttonGroup.buttons)), _g = _f.next(); !_g.done; _g = _f.next()) {
                            var button = _g.value;
                            if (!buttonGroup.visible) {
                                buttonGroup.visible = button.name.toLowerCase().indexOf(searchText) !== -1;
                                if (!buttonGroup.visible) {
                                    try {
                                        for (var _h = (e_8 = void 0, tslib_1.__values(button.details)), _j = _h.next(); !_j.done; _j = _h.next()) {
                                            var detail = _j.value;
                                            if (detail.text.toLowerCase().indexOf(searchText) !== -1) {
                                                buttonGroup.visible = true;
                                                break;
                                            }
                                        }
                                    }
                                    catch (e_8_1) { e_8 = { error: e_8_1 }; }
                                    finally {
                                        try {
                                            if (_j && !_j.done && (_c = _h.return)) _c.call(_h);
                                        }
                                        finally { if (e_8) throw e_8.error; }
                                    }
                                }
                            }
                        }
                    }
                    catch (e_7_1) { e_7 = { error: e_7_1 }; }
                    finally {
                        try {
                            if (_g && !_g.done && (_b = _f.return)) _b.call(_f);
                        }
                        finally { if (e_7) throw e_7.error; }
                    }
                }
            }
        }
        catch (e_6_1) { e_6 = { error: e_6_1 }; }
        finally {
            try {
                if (_e && !_e.done && (_a = _d.return)) _a.call(_d);
            }
            finally { if (e_6) throw e_6.error; }
        }
        if (this.visibleItemSize() !== this.buttonGroups.length) {
            this.setSearchResultsCountMessage();
        }
    };
    List.prototype.setSearchResultsCountMessage = function () {
        this._searchLabel = this.visibleItemSize() + " " +
            (this.visibleItemSize() === 1 ? this.translationService.getText("Result") : this.translationService.getText("Results"));
    };
    List.prototype.visibleItemSize = function () {
        var e_9, _a, e_10, _b;
        var result = 0;
        try {
            for (var _c = tslib_1.__values(this.buttonGroups), _d = _c.next(); !_d.done; _d = _c.next()) {
                var buttonGroup = _d.value;
                if (buttonGroup.visible) {
                    try {
                        for (var _e = (e_10 = void 0, tslib_1.__values(buttonGroup.buttons)), _f = _e.next(); !_f.done; _f = _e.next()) {
                            var button = _f.value;
                            if (button.visible) {
                                result++;
                                break;
                            }
                        }
                    }
                    catch (e_10_1) { e_10 = { error: e_10_1 }; }
                    finally {
                        try {
                            if (_f && !_f.done && (_b = _e.return)) _b.call(_e);
                        }
                        finally { if (e_10) throw e_10.error; }
                    }
                }
            }
        }
        catch (e_9_1) { e_9 = { error: e_9_1 }; }
        finally {
            try {
                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
            }
            finally { if (e_9) throw e_9.error; }
        }
        return result;
    };
    Object.defineProperty(List.prototype, "buttonGroups", {
        get: function () {
            return this._buttonGroups;
        },
        set: function (value) {
            this._buttonGroups = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "search", {
        get: function () {
            return this._search;
        },
        set: function (value) {
            this._search = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "handler", {
        get: function () {
            return this._handler;
        },
        set: function (value) {
            this._handler = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "buttonHandler", {
        get: function () {
            return this._buttonHandler;
        },
        set: function (value) {
            this._buttonHandler = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "icon", {
        get: function () {
            return this._icon;
        },
        set: function (value) {
            this._icon = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "color", {
        get: function () {
            return this._color;
        },
        set: function (value) {
            this._color = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "form", {
        get: function () {
            return this._form;
        },
        set: function (value) {
            this._form = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "formHandler", {
        get: function () {
            return this._formHandler;
        },
        set: function (value) {
            this._formHandler = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "page", {
        get: function () {
            return this._page;
        },
        set: function (value) {
            this._page = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "mockData", {
        get: function () {
            return this._mockData;
        },
        set: function (value) {
            this._mockData = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "url", {
        get: function () {
            return this._url;
        },
        set: function (value) {
            this._url = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "limit", {
        get: function () {
            return this._limit;
        },
        set: function (value) {
            this._limit = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "searchRequired", {
        get: function () {
            return this._searchRequired;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "searchRequest", {
        get: function () {
            return this._searchRequest;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "searchText", {
        get: function () {
            return this._searchText;
        },
        set: function (value) {
            this._searchText = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "searchLabel", {
        get: function () {
            return this._searchLabel;
        },
        set: function (value) {
            this._searchLabel = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "searchInputLabel", {
        get: function () {
            return this._searchInputLabel;
        },
        set: function (value) {
            this._searchInputLabel = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "searchButton", {
        get: function () {
            return this._searchButton;
        },
        enumerable: true,
        configurable: true
    });
    List.prototype.fromJson = function (modelElement) {
        var _this = this;
        _super.prototype.fromJson.call(this, modelElement);
        if (modelElement["search"] != null) {
            this.search = modelElement["search"];
        }
        if (modelElement["searchRequired"] != null) {
            this._searchRequired = modelElement["searchRequired"];
        }
        if (modelElement["searchRequest"] != null) {
            this._searchRequest = modelElement["searchRequest"];
        }
        if (modelElement["limit"] != null) {
            this.limit = modelElement["limit"];
        }
        // verify valid search combinations
        if (!this.search && this.searchRequired) {
            console.log("Configuration Error: search=false requires searchRequired=false");
            this._searchRequired = false;
        }
        if (this.searchRequired && !this.searchRequest) {
            console.log("Configuration Error: searchRequired=true requires searchRequest=true");
            this._searchRequest = true;
        }
        // other model attributes
        if (modelElement["color"] != null) {
            this.color = modelElement["color"];
        }
        if (modelElement["form"] != null) {
            this.form = modelElement["form"]["form"];
            this.formHandler = modelElement["form"]["handler"];
        }
        if (modelElement["page"] != null) {
            this.page = modelElement["page"];
        }
        if (modelElement["icon"] != null) {
            this.icon = modelElement["icon"];
        }
        if (modelElement["data"] != null) {
            this.mockData = modelElement["data"];
        }
        if (modelElement["name"] != null) {
            this.name = this.translationService.getText(modelElement["name"]);
        }
        if (modelElement["url"] != null) {
            var urlString = modelElement["url"];
            this.url = KeyUtility.translateUrl(urlString, null, false, this);
        }
        // override from PageElement
        if (modelElement["width"] != null) {
            this.width = modelElement["width"];
        }
        else {
            this.width = 2; // special default for list
        }
        // search button
        var searchButtonModel = {};
        searchButtonModel["color"] = modelElement["searchColor"] != null ? modelElement["searchColor"] : "tile-search";
        searchButtonModel["width"] = modelElement["searchWidth"] != null ? modelElement["searchWidth"] : this.width;
        this._searchButton.fromJson(searchButtonModel);
        // delay for search field
        var debounceTimeValue = this.searchRequest ? 300 : 30;
        this._searchTextChanged.pipe(debounceTime(debounceTimeValue)) // wait after the last event before emitting last event
            .subscribe(function (_searchText) {
            _this._searchText = _searchText;
            _this.filter();
        });
    };
    return List;
}(PageElement));
export { List };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9wYXRoLWZyYW1ld29yay8iLCJzb3VyY2VzIjpbInBhdGgtZnJhbWV3b3JrL3BhZ2UvZWxlbWVudC9saXN0L2xpc3QuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFFQSxPQUFPLEVBQWdCLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBRXRFLE9BQU8sRUFBQyxXQUFXLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUU1QyxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sOEJBQThCLENBQUM7QUFDeEQsT0FBTyxFQUFDLE1BQU0sRUFBQyxNQUFNLDRCQUE0QixDQUFDO0FBQ2xELE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSw2QkFBNkIsQ0FBQztBQUN6RCxPQUFPLEVBQUMsT0FBTyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQzdCLE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQU01QztJQUFBO0lBUUEsQ0FBQztJQUhHLHVDQUFlLEdBQWY7UUFDSSxZQUFZLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFKRDtRQUZDLEtBQUssQ0FBQyxNQUFNLENBQUM7UUFDYixNQUFNLENBQUMsTUFBTSxDQUFDOytDQUNKO0lBSEYsYUFBYTtRQUp6QixTQUFTLENBQUM7WUFDUCxRQUFRLEVBQUUsV0FBVztZQUNyQiwycURBQWtDO1NBQ3JDLENBQUM7T0FDVyxhQUFhLENBUXpCO0lBQUQsb0JBQUM7Q0FBQSxBQVJELElBUUM7U0FSWSxhQUFhO0FBVTFCO0lBQTBCLGdDQUFXO0lBcUJqQyxjQUFZLEdBQWEsRUFBVSxXQUF3QixFQUFVLGtCQUFzQztRQUEzRyxZQUNJLGtCQUFNLEdBQUcsQ0FBQyxTQUliO1FBTGtDLGlCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQVUsd0JBQWtCLEdBQWxCLGtCQUFrQixDQUFv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QUssR0FBRyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDdEM7UUFDRCxJQUFJLFlBQVksQ0FBQyxNQUFNLENBQUMsSUFBSSxJQUFJLEVBQUU7WUFDOUIsSUFBSSxDQUFDLElBQUksR0FBRyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDekMsSUFBSSxDQUFDLFdBQVcsR0FBRyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUM7U0FDdEQ7UUFDRCxJQUFJLFlBQVksQ0FBQyxNQUFNLENBQUMsSUFBSSxJQUFJLEVBQUU7WUFDOUIsSUFBSSxDQUFDLElBQUksR0FBRyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDcEM7UUFDRCxJQUFJLFlBQVksQ0FBQyxNQUFNLENBQUMsSUFBSSxJQUFJLEVBQUU7WUFDOUIsSUFBSSxDQUFDLElBQUksR0FBRyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDcEM7UUFDRCxJQUFJLFlBQVksQ0FBQyxNQUFNLENBQUMsSUFBSSxJQUFJLEVBQUU7WUFDOUIsSUFBSSxDQUFDLFFBQVEsR0FBRyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDeEM7UUFDRCxJQUFJLFlBQVksQ0FBQyxNQUFNLENBQUMsSUFBSSxJQUFJLEVBQUU7WUFDOUIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1NBQ3JFO1FBQ0QsSUFBSSxZQUFZLENBQUMsS0FBSyxDQUFDLElBQUksSUFBSSxFQUFFO1lBQzdCLElBQU0sU0FBUyxHQUFXLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM5QyxJQUFJLENBQUMsR0FBRyxHQUFHLFVBQVUsQ0FBQyxZQUFZLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDcEU7UUFDRCw0QkFBNEI7UUFDNUIsSUFBSSxZQUFZLENBQUMsT0FBTyxDQUFDLElBQUksSUFBSSxFQUFFO1lBQy9CLElBQUksQ0FBQyxLQUFLLEdBQUcsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQ3RDO2FBQU07WUFDSCxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLDJCQUEyQjtTQUM5QztRQUNELGdCQUFnQjtRQUNoQixJQUFNLGlCQUFpQixHQUFHLEVBQUUsQ0FBQztRQUM3QixpQkFBaUIsQ0FBQyxPQUFPLENBQUMsR0FBRyxZQUFZLENBQUMsYUFBYSxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQztRQUMvRyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsR0FBRyxZQUFZLENBQUMsYUFBYSxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDNUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUMvQyx5QkFBeUI7UUFDekIsSUFBTSxpQkFBaUIsR0FBVyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUNoRSxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUN4QixZQUFZLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLHVEQUF1RDthQUN2RixTQUFTLENBQUMsVUFBQSxXQUFXO1lBQ2xCLEtBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1lBQy9CLEtBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNsQixDQUFDLENBQUMsQ0FBQztJQUNYLENBQUM7SUFDTCxXQUFDO0FBQUQsQ0FBQyxBQWhhRCxDQUEwQixXQUFXLEdBZ2FwQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7SUJ1dHRvbiwgSUJ1dHRvbkhhbmRsZXIsIElMaXN0LCBJTGlzdEhhbmRsZXIsIElQYXRoQXBwfSBmcm9tIFwiLi4vLi4vLi4vcGF0aGludGVyZmFjZVwiO1xyXG5pbXBvcnQge1BhdGhTZXJ2aWNlfSBmcm9tIFwiLi4vLi4vLi4vc2VydmljZS9wYXRoLnNlcnZpY2VcIjtcclxuaW1wb3J0IHtBZnRlclZpZXdJbml0LCBDb21wb25lbnQsIElucHV0LCBPdXRwdXR9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7QnV0dG9uR3JvdXB9IGZyb20gXCIuLi9idXR0b24tZ3JvdXAvYnV0dG9uLWdyb3VwLmNvbXBvbmVudFwiO1xyXG5pbXBvcnQge1BhZ2VFbGVtZW50fSBmcm9tIFwiLi4vcGFnZS1lbGVtZW50XCI7XHJcbmltcG9ydCB7VHJhbnNsYXRpb25TZXJ2aWNlfSBmcm9tIFwiLi4vLi4vLi4vc2VydmljZS90cmFuc2xhdGlvbi5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7S2V5VXRpbGl0eX0gZnJvbSBcIi4uLy4uLy4uL3V0aWxpdHkva2V5LXV0aWxpdHlcIjtcclxuaW1wb3J0IHtCdXR0b259IGZyb20gXCIuLi9idXR0b24vYnV0dG9uLmNvbXBvbmVudFwiO1xyXG5pbXBvcnQge0ZvY3VzVXRpbGl0eX0gZnJvbSBcIi4uLy4uLy4uL2Zvcm0vZm9jdXMtdXRpbGl0eVwiO1xyXG5pbXBvcnQge1N1YmplY3R9IGZyb20gXCJyeGpzXCI7XHJcbmltcG9ydCB7ZGVib3VuY2VUaW1lfSBmcm9tIFwicnhqcy9vcGVyYXRvcnNcIjtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6IFwicGF0aC1saXN0XCIsXHJcbiAgICB0ZW1wbGF0ZVVybDogXCJsaXN0LmNvbXBvbmVudC5odG1sXCJcclxufSlcclxuZXhwb3J0IGNsYXNzIExpc3RDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0IHtcclxuICAgIEBJbnB1dChcImxpc3RcIilcclxuICAgIEBPdXRwdXQoXCJsaXN0XCIpXHJcbiAgICBsaXN0OiBMaXN0O1xyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICBGb2N1c1V0aWxpdHkuZm9jdXNGaXJzdEZpZWxkKG51bGwpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgTGlzdCBleHRlbmRzIFBhZ2VFbGVtZW50IGltcGxlbWVudHMgSUxpc3Qge1xyXG4gICAgcHJpdmF0ZSBfYnV0dG9uR3JvdXBzOiBCdXR0b25Hcm91cFtdID0gW107XHJcbiAgICBwcml2YXRlIF9zZWFyY2g6IGJvb2xlYW47XHJcbiAgICBwcml2YXRlIF9saW1pdDogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBfc2VhcmNoUmVxdWlyZWQ6IGJvb2xlYW47XHJcbiAgICBwcml2YXRlIF9zZWFyY2hSZXF1ZXN0OiBib29sZWFuO1xyXG4gICAgcHJpdmF0ZSBfc2VhcmNoTGFiZWw6IHN0cmluZztcclxuICAgIHByaXZhdGUgX3NlYXJjaElucHV0TGFiZWw6IHN0cmluZztcclxuICAgIHByaXZhdGUgX3NlYXJjaFRleHQ6IHN0cmluZztcclxuICAgIHByaXZhdGUgX3NlYXJjaFRleHRDaGFuZ2VkOiBTdWJqZWN0PHN0cmluZz4gPSBuZXcgU3ViamVjdDxzdHJpbmc+KCk7XHJcbiAgICBwcml2YXRlIF9zZWFyY2hCdXR0b246IEJ1dHRvbjtcclxuICAgIHByaXZhdGUgX2hhbmRsZXI6IElMaXN0SGFuZGxlcjtcclxuICAgIHByaXZhdGUgX2J1dHRvbkhhbmRsZXI6IElCdXR0b25IYW5kbGVyO1xyXG4gICAgcHJpdmF0ZSBfaWNvbjogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSBfY29sb3I6IHN0cmluZztcclxuICAgIHByaXZhdGUgX2Zvcm06IHN0cmluZztcclxuICAgIHByaXZhdGUgX2Zvcm1IYW5kbGVyOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF9wYWdlOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF9tb2NrRGF0YTogYW55O1xyXG4gICAgcHJpdmF0ZSBfdXJsOiBzdHJpbmc7XHJcblxyXG4gICAgY29uc3RydWN0b3IoYXBwOiBJUGF0aEFwcCwgcHJpdmF0ZSBwYXRoU2VydmljZTogUGF0aFNlcnZpY2UsIHByaXZhdGUgdHJhbnNsYXRpb25TZXJ2aWNlOiBUcmFuc2xhdGlvblNlcnZpY2UpIHtcclxuICAgICAgICBzdXBlcihhcHApO1xyXG4gICAgICAgIHRoaXMuX3NlYXJjaExhYmVsID0gdHJhbnNsYXRpb25TZXJ2aWNlLmdldFRleHQoXCJTZWFyY2hcIik7XHJcbiAgICAgICAgdGhpcy5fc2VhcmNoSW5wdXRMYWJlbCA9IHRyYW5zbGF0aW9uU2VydmljZS5nZXRUZXh0KFwiU2VhcmNoSW5wdXRMYWJlbFwiKTtcclxuICAgICAgICB0aGlzLl9zZWFyY2hCdXR0b24gPSBuZXcgQnV0dG9uKGFwcCwgcGF0aFNlcnZpY2UsIHRyYW5zbGF0aW9uU2VydmljZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldENvbnRlbnQoKTogSUJ1dHRvbltdIHtcclxuICAgICAgICBjb25zdCBidXR0b25zOiBCdXR0b25bXSA9IFtdO1xyXG4gICAgICAgIGZvciAoY29uc3QgYnV0dG9uR3JvdXAgb2YgdGhpcy5idXR0b25Hcm91cHMpIHtcclxuICAgICAgICAgICAgYnV0dG9ucy5wdXNoKC4uLmJ1dHRvbkdyb3VwLmJ1dHRvbnMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYnV0dG9ucztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcmVmcmVzaChzZWFyY2hUZXh0OiBzdHJpbmcsIGFmdGVyUmVmcmVzaEhhbmRsZXI6ICgpID0+IHZvaWQpIHtcclxuICAgICAgICAvLyBjYWxsYmFjayBmdW5jdGlvbiBmb3IgZGF0YVxyXG4gICAgICAgIGNvbnNvbGUubG9nKFwicmVmcmVzaCBsaXN0IChzZWFyY2hUZXh0OiBcIiArIHNlYXJjaFRleHQgKyBcIilcIik7XHJcbiAgICAgICAgY29uc3QgZGF0YUhhbmRsZXIgPSAoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuYnV0dG9uR3JvdXBzID0gW107XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgYnV0dG9uIGdyb3VwIGFuZCBidXR0b25zXHJcbiAgICAgICAgICAgICAgICAvLyBzZXQgZGVmYXVsdCB0eXBlcyBpZiBzZXJ2ZXIgZG9lcyBub3Qgc2V0IHR5cGUgKGJ1dHRvbiBvciBidXR0b25Hcm91cClcclxuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1Jc0J1dHRvbkdyb3VwOiBib29sZWFuID0gaXRlbS5oYXNPd25Qcm9wZXJ0eShcImJ1dHRvbnNcIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbUlzQnV0dG9uR3JvdXApIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtW1widHlwZVwiXSA9IFwiYnV0dG9uR3JvdXBcIjtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGJ1dHRvbiBvZiBpdGVtLmJ1dHRvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJ1dHRvbltcInR5cGVcIl0gPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uW1widHlwZVwiXSA9IFwiYnV0dG9uXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtW1widHlwZVwiXSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1bXCJ0eXBlXCJdID0gXCJidXR0b25cIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwYWdlRWxlbWVudHMgPSB0aGlzLmFwcC5jcmVhdGVQYWdlRWxlbWVudChpdGVtLCB0aGlzLnBhcmVudFBhZ2VFbGVtZW50LCBudWxsKTtcclxuICAgICAgICAgICAgICAgIGlmIChwYWdlRWxlbWVudHMubGVuZ3RoICE9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvciBjcmVhdGluZyBidXR0b24gZ3JvdXAgZnJvbTogXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBidXR0b25Hcm91cCA9IDxCdXR0b25Hcm91cD5wYWdlRWxlbWVudHNbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGJ1dHRvbkNvdW50ZXIgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgYnV0dG9uIG9mIGJ1dHRvbkdyb3VwLmJ1dHRvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmxpc3RFbGVtZW50ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1vZGVsIGlzIGVpdGhlciBzaW1wbGUgYnV0dG9uIG9yIGJ1dHRvbiBvZiBhIGdyb3VwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBidXR0b25Nb2RlbCA9IGl0ZW07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtSXNCdXR0b25Hcm91cCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uTW9kZWwgPSBpdGVtLmJ1dHRvbnNbYnV0dG9uQ291bnRlcl07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ1aWxkIGJ1dHRvbiBmcm9tIGpzb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXNlIGxpc3QgZGVmYXVsdHMgaWYgYnV0dG9uIGRvZXMgbm90IHNwZWNpZnkgbW9kZWxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJ1dHRvbk1vZGVsW1wiaWNvblwiXSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b25Nb2RlbFtcImljb25cIl0gPSB0aGlzLmljb247XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJ1dHRvbk1vZGVsW1wiY29sb3JcIl0gPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uTW9kZWxbXCJjb2xvclwiXSA9IHRoaXMuY29sb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJ1dHRvbk1vZGVsW1wicGFnZVwiXSA9PSBudWxsICYmIChidXR0b25Nb2RlbFtcImZvcm1cIl0gPT0gbnVsbCB8fCBidXR0b25Nb2RlbFtcImZvcm1cIl1bXCJmb3JtXCJdID09IG51bGwpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXJ2aWNlIGRvZXMgbm90IHJldHVybiBwYWdlIG9yIGZvcm0sIHVzZSBzdGF0aWMgbW9kZWxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBhZ2UgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbk1vZGVsW1wicGFnZVwiXSA9IHRoaXMucGFnZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZvcm0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbk1vZGVsW1wiZm9ybVwiXSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbk1vZGVsLmZvcm1bXCJmb3JtXCJdID0gdGhpcy5mb3JtO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbk1vZGVsLmZvcm1bXCJoYW5kbGVyXCJdID0gdGhpcy5mb3JtSGFuZGxlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzcGVjaWFsIGRlZmF1bHQgd2lkdGggKDIgaW5zdGVhZCBvZiAxKSBmb3IgYnV0dG9ucyBpbiBsaXN0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChidXR0b25Nb2RlbFtcIndpZHRoXCJdID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbk1vZGVsW1wid2lkdGhcIl0gPSB0aGlzLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5mcm9tSnNvbihidXR0b25Nb2RlbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzcGVjaWFsIHZhbHVlcyBmb3IgbGlzdCBidXR0b25zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5oYW5kbGVyID0gdGhpcy5fYnV0dG9uSGFuZGxlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLm5hbWUgPSBidXR0b25Nb2RlbC5uYW1lOyAvLyBubyB0cmFuc2xhdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBidXR0b24udG9vbHRpcCA9IGJ1dHRvbk1vZGVsLnRvb2x0aXA7IC8vIG5vIHRyYW5zbGF0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbkNvdW50ZXIrKztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5idXR0b25Hcm91cHMucHVzaChidXR0b25Hcm91cCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuaGFuZGxlciAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZXIuZG9Mb2FkKHRoaXMpOyAvLyBUT0RPIHVzZWZ1bD9cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyByZWZyZXNoIHNlYXJjaFxyXG4gICAgICAgICAgICB0aGlzLmZpbHRlclZpc2libGVCdXR0b25Hcm91cHMoKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMubGltaXQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0U2VhcmNoUmVzdWx0c0NvdW50TWVzc2FnZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChhZnRlclJlZnJlc2hIYW5kbGVyICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBhZnRlclJlZnJlc2hIYW5kbGVyKCk7XHJcbiAgICAgICAgICAgICAgICB9LCAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgbGlzdEhhbmRsZXJEb0xvYWQgPSAobGlzdDogSUxpc3QpID0+IChkYXRhOiBhbnkpID0+IGRhdGFIYW5kbGVyKGRhdGEpO1xyXG4gICAgICAgIC8vIGJhY2tlbmQgZGF0YVxyXG4gICAgICAgIGlmICh0aGlzLl91cmwgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBsZXQgdXJsUGFyYW1ldGVycyA9IFwiXCI7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNlYXJjaFJlcXVlc3QgfHwgdGhpcy5saW1pdCkge1xyXG4gICAgICAgICAgICAgICAgdXJsUGFyYW1ldGVycyA9IFwiP3NlYXJjaD1cIiArIChzZWFyY2hUZXh0ID09IG51bGwgPyBcIlwiIDogZW5jb2RlVVJJKHNlYXJjaFRleHQpKSArIFwiJmxpbWl0PVwiICsgdGhpcy5saW1pdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnBhdGhTZXJ2aWNlLnNlcnZlckdldCh0aGlzLmFwcC5nZXRCYWNrZW5kVXJsKCksIHRoaXMudXJsICsgdXJsUGFyYW1ldGVycywgbGlzdEhhbmRsZXJEb0xvYWQodGhpcyksIG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBtb2NrIGRhdGFcclxuICAgICAgICBpZiAodGhpcy5fbW9ja0RhdGEgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBsZXQgY291bnQgPSAwO1xyXG4gICAgICAgICAgICAvLyBmYWtlIGEga2V5IGZvciBtb2NrIGRhdGFcclxuICAgICAgICAgICAgZm9yIChjb25zdCBtb2NrIG9mIHRoaXMubW9ja0RhdGEpIHtcclxuICAgICAgICAgICAgICAgIGNvdW50Kys7XHJcbiAgICAgICAgICAgICAgICBpZiAobW9ja1tcImtleVwiXSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9ja1tcImtleVwiXSA9IGNvdW50O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGRhdGFIYW5kbGVyKHRoaXMubW9ja0RhdGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZmlsdGVyQ2hhbmdlZCh0ZXh0OiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLl9zZWFyY2hUZXh0Q2hhbmdlZC5uZXh0KHRleHQpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBmaWx0ZXIoKSB7XHJcbiAgICAgICAgdGhpcy5fc2VhcmNoTGFiZWwgPSB0aGlzLnRyYW5zbGF0aW9uU2VydmljZS5nZXRUZXh0KFwiU2VhcmNoXCIpO1xyXG4gICAgICAgIGlmICh0aGlzLl9zZWFyY2hUZXh0ICYmIHRoaXMuX3NlYXJjaFRleHQgPT09IFwiKlwiKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaChudWxsLCBudWxsKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc2VhcmNoUmVxdWVzdCkge1xyXG4gICAgICAgICAgICAvLyBjYWxsIHNlcnZlciB0byBmaWx0ZXIgZGF0YVxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX3NlYXJjaFRleHQgJiYgdGhpcy5zZWFyY2hSZXF1aXJlZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fYnV0dG9uR3JvdXBzID0gW107XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fc2VhcmNoVGV4dCA9PT0gXCIqXCIgfHwgKCF0aGlzLl9zZWFyY2hUZXh0ICYmICF0aGlzLnNlYXJjaFJlcXVpcmVkKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoKG51bGwsIG51bGwpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX3NlYXJjaFRleHQgJiYgdGhpcy5fc2VhcmNoVGV4dC5sZW5ndGggPj0gMikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoKHRoaXMuX3NlYXJjaFRleHQsIG51bGwpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc2VhcmNoTGFiZWwgPSB0aGlzLnRyYW5zbGF0aW9uU2VydmljZS5nZXRUZXh0KFwiU2VhcmNoVGV4dFRvb1Nob3J0XCIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fYnV0dG9uR3JvdXBzID0gW107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBmaWx0ZXIgbG9hZGVkIGRhdGEgb25seVxyXG4gICAgICAgICAgICB0aGlzLmZpbHRlclZpc2libGVCdXR0b25Hcm91cHMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBmaWx0ZXJWaXNpYmxlQnV0dG9uR3JvdXBzKCkge1xyXG4gICAgICAgIGNvbnN0IHNlYXJjaFRleHQ6IHN0cmluZyA9IHRoaXMuX3NlYXJjaFRleHQgPyB0aGlzLl9zZWFyY2hUZXh0LnRvTG93ZXJDYXNlKCkgOiBcIlwiO1xyXG4gICAgICAgIGZvciAoY29uc3QgYnV0dG9uR3JvdXAgb2YgdGhpcy5fYnV0dG9uR3JvdXBzKSB7XHJcbiAgICAgICAgICAgIGlmIChzZWFyY2hUZXh0Lmxlbmd0aCA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBidXR0b25Hcm91cC52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGJ1dHRvbkdyb3VwLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgYnV0dG9uIG9mIGJ1dHRvbkdyb3VwLmJ1dHRvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWJ1dHRvbkdyb3VwLnZpc2libGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uR3JvdXAudmlzaWJsZSA9IGJ1dHRvbi5uYW1lLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihzZWFyY2hUZXh0KSAhPT0gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYnV0dG9uR3JvdXAudmlzaWJsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBkZXRhaWwgb2YgYnV0dG9uLmRldGFpbHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGV0YWlsLnRleHQudG9Mb3dlckNhc2UoKS5pbmRleE9mKHNlYXJjaFRleHQpICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b25Hcm91cC52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnZpc2libGVJdGVtU2l6ZSgpICE9PSB0aGlzLmJ1dHRvbkdyb3Vwcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRTZWFyY2hSZXN1bHRzQ291bnRNZXNzYWdlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0U2VhcmNoUmVzdWx0c0NvdW50TWVzc2FnZSgpIHtcclxuICAgICAgICB0aGlzLl9zZWFyY2hMYWJlbCA9IHRoaXMudmlzaWJsZUl0ZW1TaXplKCkgKyBcIiBcIiArXHJcbiAgICAgICAgICAgICh0aGlzLnZpc2libGVJdGVtU2l6ZSgpID09PSAxID8gdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuZ2V0VGV4dChcIlJlc3VsdFwiKSA6IHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLmdldFRleHQoXCJSZXN1bHRzXCIpKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHZpc2libGVJdGVtU2l6ZSgpOiBudW1iZXIge1xyXG4gICAgICAgIGxldCByZXN1bHQgPSAwO1xyXG4gICAgICAgIGZvciAoY29uc3QgYnV0dG9uR3JvdXAgb2YgdGhpcy5idXR0b25Hcm91cHMpIHtcclxuICAgICAgICAgICAgaWYgKGJ1dHRvbkdyb3VwLnZpc2libGUpIHtcclxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgYnV0dG9uIG9mIGJ1dHRvbkdyb3VwLmJ1dHRvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYnV0dG9uLnZpc2libGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBidXR0b25Hcm91cHMoKTogQnV0dG9uR3JvdXBbXSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2J1dHRvbkdyb3VwcztcclxuICAgIH1cclxuXHJcbiAgICBzZXQgYnV0dG9uR3JvdXBzKHZhbHVlOiBCdXR0b25Hcm91cFtdKSB7XHJcbiAgICAgICAgdGhpcy5fYnV0dG9uR3JvdXBzID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHNlYXJjaCgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc2VhcmNoO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBzZWFyY2godmFsdWU6IGJvb2xlYW4pIHtcclxuICAgICAgICB0aGlzLl9zZWFyY2ggPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgaGFuZGxlcigpOiBJTGlzdEhhbmRsZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVyO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBoYW5kbGVyKHZhbHVlOiBJTGlzdEhhbmRsZXIpIHtcclxuICAgICAgICB0aGlzLl9oYW5kbGVyID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGJ1dHRvbkhhbmRsZXIoKTogSUJ1dHRvbkhhbmRsZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9idXR0b25IYW5kbGVyO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBidXR0b25IYW5kbGVyKHZhbHVlOiBJQnV0dG9uSGFuZGxlcikge1xyXG4gICAgICAgIHRoaXMuX2J1dHRvbkhhbmRsZXIgPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgaWNvbigpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pY29uO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBpY29uKHZhbHVlOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLl9pY29uID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGNvbG9yKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbG9yO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBjb2xvcih2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5fY29sb3IgPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZm9ybSgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9mb3JtO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBmb3JtKHZhbHVlOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLl9mb3JtID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGZvcm1IYW5kbGVyKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Zvcm1IYW5kbGVyO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBmb3JtSGFuZGxlcih2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5fZm9ybUhhbmRsZXIgPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgcGFnZSgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wYWdlO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBwYWdlKHZhbHVlOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLl9wYWdlID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IG1vY2tEYXRhKCk6IGFueSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX21vY2tEYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBtb2NrRGF0YSh2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgdGhpcy5fbW9ja0RhdGEgPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgdXJsKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3VybDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgdXJsKHZhbHVlOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLl91cmwgPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgbGltaXQoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbGltaXQ7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGxpbWl0KHZhbHVlOiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLl9saW1pdCA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBzZWFyY2hSZXF1aXJlZCgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc2VhcmNoUmVxdWlyZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHNlYXJjaFJlcXVlc3QoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NlYXJjaFJlcXVlc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHNlYXJjaFRleHQoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc2VhcmNoVGV4dDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgc2VhcmNoTGFiZWwoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc2VhcmNoTGFiZWw7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHNlYXJjaElucHV0TGFiZWwoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc2VhcmNoSW5wdXRMYWJlbDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgc2VhcmNoTGFiZWwodmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuX3NlYXJjaExhYmVsID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHNlYXJjaElucHV0TGFiZWwodmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuX3NlYXJjaElucHV0TGFiZWwgPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgc2VhcmNoVGV4dCh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5fc2VhcmNoVGV4dCA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBzZWFyY2hCdXR0b24oKTogQnV0dG9uIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc2VhcmNoQnV0dG9uO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBmcm9tSnNvbihtb2RlbEVsZW1lbnQpIHtcclxuICAgICAgICBzdXBlci5mcm9tSnNvbihtb2RlbEVsZW1lbnQpO1xyXG4gICAgICAgIGlmIChtb2RlbEVsZW1lbnRbXCJzZWFyY2hcIl0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLnNlYXJjaCA9IG1vZGVsRWxlbWVudFtcInNlYXJjaFwiXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1vZGVsRWxlbWVudFtcInNlYXJjaFJlcXVpcmVkXCJdICE9IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5fc2VhcmNoUmVxdWlyZWQgPSBtb2RlbEVsZW1lbnRbXCJzZWFyY2hSZXF1aXJlZFwiXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1vZGVsRWxlbWVudFtcInNlYXJjaFJlcXVlc3RcIl0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLl9zZWFyY2hSZXF1ZXN0ID0gbW9kZWxFbGVtZW50W1wic2VhcmNoUmVxdWVzdFwiXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1vZGVsRWxlbWVudFtcImxpbWl0XCJdICE9IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5saW1pdCA9IG1vZGVsRWxlbWVudFtcImxpbWl0XCJdO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyB2ZXJpZnkgdmFsaWQgc2VhcmNoIGNvbWJpbmF0aW9uc1xyXG4gICAgICAgIGlmICghdGhpcy5zZWFyY2ggJiYgdGhpcy5zZWFyY2hSZXF1aXJlZCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNvbmZpZ3VyYXRpb24gRXJyb3I6IHNlYXJjaD1mYWxzZSByZXF1aXJlcyBzZWFyY2hSZXF1aXJlZD1mYWxzZVwiKTtcclxuICAgICAgICAgICAgdGhpcy5fc2VhcmNoUmVxdWlyZWQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuc2VhcmNoUmVxdWlyZWQgJiYgIXRoaXMuc2VhcmNoUmVxdWVzdCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNvbmZpZ3VyYXRpb24gRXJyb3I6IHNlYXJjaFJlcXVpcmVkPXRydWUgcmVxdWlyZXMgc2VhcmNoUmVxdWVzdD10cnVlXCIpO1xyXG4gICAgICAgICAgICB0aGlzLl9zZWFyY2hSZXF1ZXN0ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gb3RoZXIgbW9kZWwgYXR0cmlidXRlc1xyXG4gICAgICAgIGlmIChtb2RlbEVsZW1lbnRbXCJjb2xvclwiXSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29sb3IgPSBtb2RlbEVsZW1lbnRbXCJjb2xvclwiXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1vZGVsRWxlbWVudFtcImZvcm1cIl0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLmZvcm0gPSBtb2RlbEVsZW1lbnRbXCJmb3JtXCJdW1wiZm9ybVwiXTtcclxuICAgICAgICAgICAgdGhpcy5mb3JtSGFuZGxlciA9IG1vZGVsRWxlbWVudFtcImZvcm1cIl1bXCJoYW5kbGVyXCJdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobW9kZWxFbGVtZW50W1wicGFnZVwiXSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFnZSA9IG1vZGVsRWxlbWVudFtcInBhZ2VcIl07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChtb2RlbEVsZW1lbnRbXCJpY29uXCJdICE9IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5pY29uID0gbW9kZWxFbGVtZW50W1wiaWNvblwiXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1vZGVsRWxlbWVudFtcImRhdGFcIl0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLm1vY2tEYXRhID0gbW9kZWxFbGVtZW50W1wiZGF0YVwiXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1vZGVsRWxlbWVudFtcIm5hbWVcIl0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLm5hbWUgPSB0aGlzLnRyYW5zbGF0aW9uU2VydmljZS5nZXRUZXh0KG1vZGVsRWxlbWVudFtcIm5hbWVcIl0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobW9kZWxFbGVtZW50W1widXJsXCJdICE9IG51bGwpIHtcclxuICAgICAgICAgICAgY29uc3QgdXJsU3RyaW5nOiBzdHJpbmcgPSBtb2RlbEVsZW1lbnRbXCJ1cmxcIl07XHJcbiAgICAgICAgICAgIHRoaXMudXJsID0gS2V5VXRpbGl0eS50cmFuc2xhdGVVcmwodXJsU3RyaW5nLCBudWxsLCBmYWxzZSwgdGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIG92ZXJyaWRlIGZyb20gUGFnZUVsZW1lbnRcclxuICAgICAgICBpZiAobW9kZWxFbGVtZW50W1wid2lkdGhcIl0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLndpZHRoID0gbW9kZWxFbGVtZW50W1wid2lkdGhcIl07XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy53aWR0aCA9IDI7IC8vIHNwZWNpYWwgZGVmYXVsdCBmb3IgbGlzdFxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBzZWFyY2ggYnV0dG9uXHJcbiAgICAgICAgY29uc3Qgc2VhcmNoQnV0dG9uTW9kZWwgPSB7fTtcclxuICAgICAgICBzZWFyY2hCdXR0b25Nb2RlbFtcImNvbG9yXCJdID0gbW9kZWxFbGVtZW50W1wic2VhcmNoQ29sb3JcIl0gIT0gbnVsbCA/IG1vZGVsRWxlbWVudFtcInNlYXJjaENvbG9yXCJdIDogXCJ0aWxlLXNlYXJjaFwiO1xyXG4gICAgICAgIHNlYXJjaEJ1dHRvbk1vZGVsW1wid2lkdGhcIl0gPSBtb2RlbEVsZW1lbnRbXCJzZWFyY2hXaWR0aFwiXSAhPSBudWxsID8gbW9kZWxFbGVtZW50W1wic2VhcmNoV2lkdGhcIl0gOiB0aGlzLndpZHRoO1xyXG4gICAgICAgIHRoaXMuX3NlYXJjaEJ1dHRvbi5mcm9tSnNvbihzZWFyY2hCdXR0b25Nb2RlbCk7XHJcbiAgICAgICAgLy8gZGVsYXkgZm9yIHNlYXJjaCBmaWVsZFxyXG4gICAgICAgIGNvbnN0IGRlYm91bmNlVGltZVZhbHVlOiBudW1iZXIgPSB0aGlzLnNlYXJjaFJlcXVlc3QgPyAzMDAgOiAzMDtcclxuICAgICAgICB0aGlzLl9zZWFyY2hUZXh0Q2hhbmdlZC5waXBlKFxyXG4gICAgICAgICAgICBkZWJvdW5jZVRpbWUoZGVib3VuY2VUaW1lVmFsdWUpKSAvLyB3YWl0IGFmdGVyIHRoZSBsYXN0IGV2ZW50IGJlZm9yZSBlbWl0dGluZyBsYXN0IGV2ZW50XHJcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoX3NlYXJjaFRleHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc2VhcmNoVGV4dCA9IF9zZWFyY2hUZXh0O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXIoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuIl19