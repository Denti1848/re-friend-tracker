import * as tslib_1 from "tslib";
import { Component, Input, Output } from "@angular/core";
import { ValueField } from "../value-field";
import { FormFunction } from "../../form-function";
import { Form } from "../../form.component";
import { OkButton } from "../button/ok-button";
import { CancelButton } from "../button/cancel-button";
import { TextField } from "../text/text-field.component";
import { FocusUtility } from "../../focus-utility";
var TranslationFieldComponent = /** @class */ (function () {
    function TranslationFieldComponent() {
    }
    tslib_1.__decorate([
        Input("field"),
        Output("field")
    ], TranslationFieldComponent.prototype, "field", void 0);
    TranslationFieldComponent = tslib_1.__decorate([
        Component({
            selector: "path-translationfield",
            template: "<path-form-field-label [label]=\"field.name\" [required]=\"field.required\"></path-form-field-label>\r\n<div [class.col-md-4]=\"field.width == 1\" [class.col-md-10]=\"field.width == 2\">\r\n    <div class=\"input-group\">\r\n        <input *ngIf=\"field.height == null || field.height <= 1\" #model=\"ngModel\" readonly-with-required (keydown)=\"field.editTranslations()\" (click)=\"field.editTranslations()\" [class.required-field]=\"!model.valid && !model.pristine && field.required\" [required]=\"field.required\" [(ngModel)]=\"field.defaultTranslation\" type=\"text\" class=\"form-control\" placeholder=\"\">\r\n        <textarea *ngIf=\"field.height != null && field.height > 1\" #model=\"ngModel\" readonly-with-required (keydown)=\"field.editTranslations()\" (click)=\"field.editTranslations()\" [class.required-field]=\"(!model.valid &&!model.pristine && field.required)\" [required]=\"field.required\" [(ngModel)]=field.defaultTranslation rows=\"{{field.height}}\" type=\"text\" class=\"form-control\" placeholder=\"\"></textarea>\r\n        <span class=\"input-group-btn\">\r\n                <button [disabled]=\"field.isReadonly()\" (click)=\"field.editTranslations()\" class=\"btn btn-default\" type=\"button\">{{field.translationLabel}}...</button>\r\n        </span>\r\n    </div>\r\n</div>\r\n"
        })
    ], TranslationFieldComponent);
    return TranslationFieldComponent;
}());
export { TranslationFieldComponent };
var TranslationField = /** @class */ (function (_super) {
    tslib_1.__extends(TranslationField, _super);
    function TranslationField(form, pathService, translationService) {
        var e_1, _a;
        var _this = _super.call(this, form, translationService) || this;
        _this.pathService = pathService;
        _this.translationService = translationService;
        _this._defaultTranslation = null;
        _this.userLanguage = translationService.getUserLanguage();
        _this.languages = translationService.getSupportedLanguageCodes();
        var initialList = [];
        try {
            for (var _b = tslib_1.__values(_this.languages), _c = _b.next(); !_c.done; _c = _b.next()) {
                var language = _c.value;
                initialList.push([{ "key": language }, ""]);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        _this.setValue(initialList);
        _this._translationLabel = translationService.getText("Translation");
        return _this;
    }
    Object.defineProperty(TranslationField.prototype, "defaultTranslation", {
        get: function () {
            return this._defaultTranslation;
        },
        set: function (value) {
            this._defaultTranslation = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TranslationField.prototype, "translationLabel", {
        get: function () {
            return this._translationLabel;
        },
        enumerable: true,
        configurable: true
    });
    TranslationField.prototype.setValue = function (value) {
        _super.prototype.setValue.call(this, value);
        this._defaultTranslation = this.getDefaultTranslation();
    };
    TranslationField.prototype.getDefaultTranslation = function () {
        var e_2, _a;
        if (this.value != null) {
            try {
                for (var _b = tslib_1.__values(this.value), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var item = _c.value;
                    if (item[0] != null && item[0]["key"] === this.userLanguage) {
                        return item[1];
                    }
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_2) throw e_2.error; }
            }
        }
        return null;
    };
    TranslationField.prototype.editTranslations = function () {
        var e_3, _a;
        var _this = this;
        var form = new Form(this.pathService, this.form.getApp());
        var translationFields = [];
        form.title = this.name + " " + this.translationService.getText("Translations");
        form.formFunction = new FormFunction();
        form.formFunction.save = function (data) {
            var e_4, _a;
            var resultList = [];
            try {
                for (var translationFields_1 = tslib_1.__values(translationFields), translationFields_1_1 = translationFields_1.next(); !translationFields_1_1.done; translationFields_1_1 = translationFields_1.next()) {
                    var field = translationFields_1_1.value;
                    resultList.push([{ "key": field.id }, field.value]);
                }
            }
            catch (e_4_1) { e_4 = { error: e_4_1 }; }
            finally {
                try {
                    if (translationFields_1_1 && !translationFields_1_1.done && (_a = translationFields_1.return)) _a.call(translationFields_1);
                }
                finally { if (e_4) throw e_4.error; }
            }
            _this.setValue(resultList);
            _this.getForm().getApp().closeCurrentForm();
        };
        form.formFunction.cancel = function () {
            _this.getForm().getApp().closeCurrentForm();
        };
        var translations = this.value;
        try {
            for (var translations_1 = tslib_1.__values(translations), translations_1_1 = translations_1.next(); !translations_1_1.done; translations_1_1 = translations_1.next()) {
                var key = translations_1_1.value;
                var textField = new TextField(form, this.translationService);
                textField.type = "text";
                textField.id = key[0]["key"];
                textField.name = this.translationService.getText(key[0]["key"]);
                textField.visible = true;
                textField.newRow = true;
                textField.width = 2;
                textField.height = this.height;
                textField.labelVisible = true;
                textField.required = true;
                textField.setValue(key[1]);
                form.fields.push(textField);
                translationFields.push(textField);
            }
        }
        catch (e_3_1) { e_3 = { error: e_3_1 }; }
        finally {
            try {
                if (translations_1_1 && !translations_1_1.done && (_a = translations_1.return)) _a.call(translations_1);
            }
            finally { if (e_3) throw e_3.error; }
        }
        var cancelButton = new CancelButton(form, this.translationService);
        cancelButton.type = "cancelButton";
        cancelButton.name = this.translationService.getText("Cancel");
        cancelButton.visible = true;
        form.fields.push(cancelButton);
        var okButton = new OkButton(form, this.translationService);
        okButton.type = "okButton";
        okButton.name = this.translationService.getText("Ok");
        okButton.visible = true;
        form.fields.push(okButton);
        form.updateRows();
        this.form.getApp()["_formStack"].push(form); // TODO
        FocusUtility.focusFirstField(form);
    };
    return TranslationField;
}(ValueField));
export { TranslationField };
var TranslationEntry = /** @class */ (function () {
    function TranslationEntry() {
    }
    Object.defineProperty(TranslationEntry.prototype, "text", {
        get: function () {
            return this._text;
        },
        set: function (value) {
            this._text = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TranslationEntry.prototype, "code", {
        get: function () {
            return this._code;
        },
        set: function (value) {
            this._code = value;
        },
        enumerable: true,
        configurable: true
    });
    return TranslationEntry;
}());
export { TranslationEntry };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNsYXRpb24tZmllbGQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vcGF0aC1mcmFtZXdvcmsvIiwic291cmNlcyI6WyJwYXRoLWZyYW1ld29yay9mb3JtL2ZpZWxkL3RyYW5zbGF0aW9uL3RyYW5zbGF0aW9uLWZpZWxkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ3ZELE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUMxQyxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0scUJBQXFCLENBQUM7QUFDakQsT0FBTyxFQUFDLElBQUksRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBQzFDLE9BQU8sRUFBQyxRQUFRLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQUM3QyxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0seUJBQXlCLENBQUM7QUFFckQsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLDhCQUE4QixDQUFDO0FBRXZELE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQU1qRDtJQUFBO0lBSUEsQ0FBQztJQURHO1FBRkMsS0FBSyxDQUFDLE9BQU8sQ0FBQztRQUNkLE1BQU0sQ0FBQyxPQUFPLENBQUM7NERBQ1E7SUFIZix5QkFBeUI7UUFKckMsU0FBUyxDQUFDO1lBQ1AsUUFBUSxFQUFFLHVCQUF1QjtZQUNqQyx5eUNBQStDO1NBQ2xELENBQUM7T0FDVyx5QkFBeUIsQ0FJckM7SUFBRCxnQ0FBQztDQUFBLEFBSkQsSUFJQztTQUpZLHlCQUF5QjtBQU10QztJQUFzQyw0Q0FBbUI7SUFPckQsMEJBQVksSUFBVSxFQUFVLFdBQXdCLEVBQVMsa0JBQXNDOztRQUF2RyxZQUNJLGtCQUFNLElBQUksRUFBRSxrQkFBa0IsQ0FBQyxTQVNsQztRQVYrQixpQkFBVyxHQUFYLFdBQVcsQ0FB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TyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQ3RCLENBQUM7YUFFRCxVQUFTLEtBQWE7WUFDbEIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDdkIsQ0FBQzs7O09BSkE7SUFNRCxzQkFBSSxrQ0FBSTthQUFSO1lBQ0ksT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQ3RCLENBQUM7YUFFRCxVQUFTLEtBQWE7WUFDbEIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDdkIsQ0FBQzs7O09BSkE7SUFLTCx1QkFBQztBQUFELENBQUMsQUFuQkQsSUFtQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgSW5wdXQsIE91dHB1dH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHtWYWx1ZUZpZWxkfSBmcm9tIFwiLi4vdmFsdWUtZmllbGRcIjtcclxuaW1wb3J0IHtGb3JtRnVuY3Rpb259IGZyb20gXCIuLi8uLi9mb3JtLWZ1bmN0aW9uXCI7XHJcbmltcG9ydCB7Rm9ybX0gZnJvbSBcIi4uLy4uL2Zvcm0uY29tcG9uZW50XCI7XHJcbmltcG9ydCB7T2tCdXR0b259IGZyb20gXCIuLi9idXR0b24vb2stYnV0dG9uXCI7XHJcbmltcG9ydCB7Q2FuY2VsQnV0dG9ufSBmcm9tIFwiLi4vYnV0dG9uL2NhbmNlbC1idXR0b25cIjtcclxuaW1wb3J0IHtQYXRoU2VydmljZX0gZnJvbSBcIi4uLy4uLy4uL3NlcnZpY2UvcGF0aC5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7VGV4dEZpZWxkfSBmcm9tIFwiLi4vdGV4dC90ZXh0LWZpZWxkLmNvbXBvbmVudFwiO1xyXG5pbXBvcnQge1RyYW5zbGF0aW9uU2VydmljZX0gZnJvbSBcIi4uLy4uLy4uL3NlcnZpY2UvdHJhbnNsYXRpb24uc2VydmljZVwiO1xyXG5pbXBvcnQge0ZvY3VzVXRpbGl0eX0gZnJvbSBcIi4uLy4uL2ZvY3VzLXV0aWxpdHlcIjtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6IFwicGF0aC10cmFuc2xhdGlvbmZpZWxkXCIsXHJcbiAgICB0ZW1wbGF0ZVVybDogXCJ0cmFuc2xhdGlvbi1maWVsZC5jb21wb25lbnQuaHRtbFwiXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBUcmFuc2xhdGlvbkZpZWxkQ29tcG9uZW50IHtcclxuICAgIEBJbnB1dChcImZpZWxkXCIpXHJcbiAgICBAT3V0cHV0KFwiZmllbGRcIilcclxuICAgIGZpZWxkOiBUcmFuc2xhdGlvbkZpZWxkO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgVHJhbnNsYXRpb25GaWVsZCBleHRlbmRzIFZhbHVlRmllbGQ8YW55W11bXT4ge1xyXG5cclxuICAgIHByaXZhdGUgbGFuZ3VhZ2VzOiBzdHJpbmdbXTtcclxuICAgIHByaXZhdGUgdXNlckxhbmd1YWdlOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF9kZWZhdWx0VHJhbnNsYXRpb246IHN0cmluZyA9IG51bGw7XHJcbiAgICBwcml2YXRlIF90cmFuc2xhdGlvbkxhYmVsOiBzdHJpbmc7XHJcblxyXG4gICAgY29uc3RydWN0b3IoZm9ybTogRm9ybSwgcHJpdmF0ZSBwYXRoU2VydmljZTogUGF0aFNlcnZpY2UsIHB1YmxpYyB0cmFuc2xhdGlvblNlcnZpY2U6IFRyYW5zbGF0aW9uU2VydmljZSkge1xyXG4gICAgICAgIHN1cGVyKGZvcm0sIHRyYW5zbGF0aW9uU2VydmljZSk7XHJcbiAgICAgICAgdGhpcy51c2VyTGFuZ3VhZ2UgPSB0cmFuc2xhdGlvblNlcnZpY2UuZ2V0VXNlckxhbmd1YWdlKCk7XHJcbiAgICAgICAgdGhpcy5sYW5ndWFnZXMgPSB0cmFuc2xhdGlvblNlcnZpY2UuZ2V0U3VwcG9ydGVkTGFuZ3VhZ2VDb2RlcygpO1xyXG4gICAgICAgIGNvbnN0IGluaXRpYWxMaXN0OiBhbnlbXVtdID0gW107XHJcbiAgICAgICAgZm9yIChjb25zdCBsYW5ndWFnZSBvZiB0aGlzLmxhbmd1YWdlcykge1xyXG4gICAgICAgICAgICBpbml0aWFsTGlzdC5wdXNoKFt7XCJrZXlcIjogbGFuZ3VhZ2V9LCBcIlwiXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2V0VmFsdWUoaW5pdGlhbExpc3QpO1xyXG4gICAgICAgIHRoaXMuX3RyYW5zbGF0aW9uTGFiZWwgPSB0cmFuc2xhdGlvblNlcnZpY2UuZ2V0VGV4dChcIlRyYW5zbGF0aW9uXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBkZWZhdWx0VHJhbnNsYXRpb24oKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZGVmYXVsdFRyYW5zbGF0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBkZWZhdWx0VHJhbnNsYXRpb24odmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuX2RlZmF1bHRUcmFuc2xhdGlvbiA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB0cmFuc2xhdGlvbkxhYmVsKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RyYW5zbGF0aW9uTGFiZWw7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldFZhbHVlKHZhbHVlOiBhbnlbXVtdKSB7XHJcbiAgICAgICAgc3VwZXIuc2V0VmFsdWUodmFsdWUpO1xyXG4gICAgICAgIHRoaXMuX2RlZmF1bHRUcmFuc2xhdGlvbiA9IHRoaXMuZ2V0RGVmYXVsdFRyYW5zbGF0aW9uKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXREZWZhdWx0VHJhbnNsYXRpb24oKTogc3RyaW5nIHtcclxuICAgICAgICBpZiAodGhpcy52YWx1ZSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbVswXSAhPSBudWxsICYmIGl0ZW1bMF1bXCJrZXlcIl0gPT09IHRoaXMudXNlckxhbmd1YWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1bMV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGVkaXRUcmFuc2xhdGlvbnMoKSB7XHJcbiAgICAgICAgY29uc3QgZm9ybTogRm9ybSA9IG5ldyBGb3JtKHRoaXMucGF0aFNlcnZpY2UsIHRoaXMuZm9ybS5nZXRBcHAoKSk7XHJcbiAgICAgICAgY29uc3QgdHJhbnNsYXRpb25GaWVsZHM6IFRleHRGaWVsZFtdID0gW107XHJcbiAgICAgICAgZm9ybS50aXRsZSA9IHRoaXMubmFtZSArIFwiIFwiICsgdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuZ2V0VGV4dChcIlRyYW5zbGF0aW9uc1wiKTtcclxuICAgICAgICBmb3JtLmZvcm1GdW5jdGlvbiA9IG5ldyBGb3JtRnVuY3Rpb24oKTtcclxuICAgICAgICBmb3JtLmZvcm1GdW5jdGlvbi5zYXZlID0gKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHRMaXN0OiBhbnlbXVtdID0gW107XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgZmllbGQgb2YgdHJhbnNsYXRpb25GaWVsZHMpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdExpc3QucHVzaChbe1wia2V5XCI6IGZpZWxkLmlkfSwgZmllbGQudmFsdWVdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnNldFZhbHVlKHJlc3VsdExpc3QpO1xyXG4gICAgICAgICAgICB0aGlzLmdldEZvcm0oKS5nZXRBcHAoKS5jbG9zZUN1cnJlbnRGb3JtKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBmb3JtLmZvcm1GdW5jdGlvbi5jYW5jZWwgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0Rm9ybSgpLmdldEFwcCgpLmNsb3NlQ3VycmVudEZvcm0oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IHRyYW5zbGF0aW9ucyA9IHRoaXMudmFsdWU7XHJcbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgdHJhbnNsYXRpb25zKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRleHRGaWVsZDogVGV4dEZpZWxkID0gbmV3IFRleHRGaWVsZChmb3JtLCB0aGlzLnRyYW5zbGF0aW9uU2VydmljZSk7XHJcbiAgICAgICAgICAgIHRleHRGaWVsZC50eXBlID0gXCJ0ZXh0XCI7XHJcbiAgICAgICAgICAgIHRleHRGaWVsZC5pZCA9IGtleVswXVtcImtleVwiXTtcclxuICAgICAgICAgICAgdGV4dEZpZWxkLm5hbWUgPSB0aGlzLnRyYW5zbGF0aW9uU2VydmljZS5nZXRUZXh0KGtleVswXVtcImtleVwiXSk7XHJcbiAgICAgICAgICAgIHRleHRGaWVsZC52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGV4dEZpZWxkLm5ld1JvdyA9IHRydWU7XHJcbiAgICAgICAgICAgIHRleHRGaWVsZC53aWR0aCA9IDI7XHJcbiAgICAgICAgICAgIHRleHRGaWVsZC5oZWlnaHQgPSB0aGlzLmhlaWdodDtcclxuICAgICAgICAgICAgdGV4dEZpZWxkLmxhYmVsVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHRleHRGaWVsZC5yZXF1aXJlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHRleHRGaWVsZC5zZXRWYWx1ZShrZXlbMV0pO1xyXG4gICAgICAgICAgICBmb3JtLmZpZWxkcy5wdXNoKHRleHRGaWVsZCk7XHJcbiAgICAgICAgICAgIHRyYW5zbGF0aW9uRmllbGRzLnB1c2godGV4dEZpZWxkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNhbmNlbEJ1dHRvbjogQ2FuY2VsQnV0dG9uID0gbmV3IENhbmNlbEJ1dHRvbihmb3JtLCB0aGlzLnRyYW5zbGF0aW9uU2VydmljZSk7XHJcbiAgICAgICAgY2FuY2VsQnV0dG9uLnR5cGUgPSBcImNhbmNlbEJ1dHRvblwiO1xyXG4gICAgICAgIGNhbmNlbEJ1dHRvbi5uYW1lID0gdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuZ2V0VGV4dChcIkNhbmNlbFwiKTtcclxuICAgICAgICBjYW5jZWxCdXR0b24udmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgZm9ybS5maWVsZHMucHVzaChjYW5jZWxCdXR0b24pO1xyXG5cclxuICAgICAgICBjb25zdCBva0J1dHRvbjogT2tCdXR0b24gPSBuZXcgT2tCdXR0b24oZm9ybSwgdGhpcy50cmFuc2xhdGlvblNlcnZpY2UpO1xyXG4gICAgICAgIG9rQnV0dG9uLnR5cGUgPSBcIm9rQnV0dG9uXCI7XHJcbiAgICAgICAgb2tCdXR0b24ubmFtZSA9IHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLmdldFRleHQoXCJPa1wiKTtcclxuICAgICAgICBva0J1dHRvbi52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICBmb3JtLmZpZWxkcy5wdXNoKG9rQnV0dG9uKTtcclxuXHJcbiAgICAgICAgZm9ybS51cGRhdGVSb3dzKCk7XHJcblxyXG4gICAgICAgIHRoaXMuZm9ybS5nZXRBcHAoKVtcIl9mb3JtU3RhY2tcIl0ucHVzaChmb3JtKTsgLy8gVE9ET1xyXG4gICAgICAgIEZvY3VzVXRpbGl0eS5mb2N1c0ZpcnN0RmllbGQoZm9ybSk7XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgVHJhbnNsYXRpb25FbnRyeSB7XHJcbiAgICBwcml2YXRlIF90ZXh0OiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF9jb2RlOiBzdHJpbmc7XHJcblxyXG4gICAgZ2V0IHRleHQoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdGV4dDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgdGV4dCh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5fdGV4dCA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjb2RlKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvZGU7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGNvZGUodmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuX2NvZGUgPSB2YWx1ZTtcclxuICAgIH1cclxufVxyXG4iXX0=