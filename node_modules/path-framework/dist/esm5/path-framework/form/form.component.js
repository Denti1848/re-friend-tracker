import * as tslib_1 from "tslib";
import { Component, Input, Output } from "@angular/core";
import { ValueField } from "./field/value-field";
import { FieldListField } from "./field/fieldList/field-list-field.component";
import { FocusUtility } from "./focus-utility";
var FormComponent = /** @class */ (function () {
    function FormComponent() {
    }
    FormComponent.prototype.onSubmit = function () {
        this.form.close(true, false);
    };
    FormComponent.prototype.ngAfterViewInit = function () {
        FocusUtility.focusFirstField(this.form);
    };
    tslib_1.__decorate([
        Input("form"),
        Output("form")
    ], FormComponent.prototype, "form", void 0);
    FormComponent = tslib_1.__decorate([
        Component({
            selector: "path-form",
            template: "<div [ngClass]=\"form.borderStyle == 2 ? 'modal-content' : ''\">\r\n\t<form (ngSubmit)=\"onSubmit()\" #pathForm=\"ngForm\" autocomplete=\"off\" ngNativeValidate>\r\n\t\t<div *ngIf=\"form.headerVisible\" class=\"modal-header\">\r\n\t\t\t<button type=\"button\" class=\"close\" data-dismiss=\"modal\" (click)=\"form.close(false,false)\">&times;</button>\r\n\t\t\t<h5 class=\"modal-title\">{{form.title}}</h5>\r\n\t\t</div>\r\n\t\t<div class=\"modal-body\">\r\n\t\t\t<div *ngFor='let row of form.rows;' class=\"row\" [hidden]=\"!row.isVisible()\">\r\n\t\t\t\t<div *ngFor='let field of row.fields;' [hidden]=\"!field.visible\">\r\n\t\t\t\t\t<div *ngIf=\"field.type == 'text'\">\r\n\t\t\t\t\t\t<path-textfield [field]=\"field\"></path-textfield>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div *ngIf=\"field.type == 'translation'\">\r\n\t\t\t\t\t\t<path-translationfield [field]=\"field\"></path-translationfield>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div *ngIf=\"field.type == 'number'\">\r\n\t\t\t\t\t\t<path-numberfield [field]=\"field\"></path-numberfield>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div *ngIf=\"field.type == 'label'\">\r\n\t\t\t\t\t\t<path-label-field [field]=\"field\"></path-label-field>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div *ngIf=\"field.type == 'fieldList'\">\r\n\t\t\t\t\t\t<path-field-list [field]=\"field\"></path-field-list>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div *ngIf=\"field.type == 'date'\">\r\n\t\t\t\t\t\t<path-datefield [field]=\"field\"></path-datefield>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div *ngIf=\"field.type == 'autocomplete'\">\r\n\t\t\t\t\t\t<path-autocomplete [field]=\"field\"></path-autocomplete>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div *ngIf=\"field.type == 'ProgressBarField'\">\r\n\t\t\t\t\t\t<path-progress-bar [field]=\"field\"></path-progress-bar>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div *ngIf=\"field.type == 'RadioGroupField'\">\r\n\t\t\t\t\t\t<path-radio-group [field]=\"field\"></path-radio-group>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div *ngIf=\"field.type == 'CheckboxGroupField'\">\r\n\t\t\t\t\t\t<path-checkbox-group [field]=\"field\"></path-checkbox-group>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div *ngIf=\"field.type == 'fileUpload'\">\r\n\t\t\t\t\t\t<path-file-upload [field]=\"field\"></path-file-upload>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<!-- show form buttons on modal-body in mobile version, otherwise they are taking up too much space when the keyboard is shown -->\r\n\t\t\t<div [hidden]=\"!form.footerVisible\" class=\"hide-on-desktop\">\r\n\t\t\t\t<div class=\"row\">\r\n                    <div class=\"col-md-12\">\r\n\t\t\t\t\t<div class=\"col-md-2 buttons-smartphone-left\">\r\n\t\t\t\t\t<span *ngFor='let field of form.fields' class=\"pull-left\" [hidden]=\"!field.visible\">\r\n\t\t\t\t\t\t<span *ngIf=\"field.type == 'deleteButton'\">\r\n\t\t\t\t\t\t\t<input [disabled]=\"field.isReadonly()\" type=\"button\" class=\"btn btn-default btn-footer\" (click)=\"field.onClick()\" value=\"{{field.name}}\"/>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t<span *ngIf=\"field.type == 'previousButton'\">\r\n\t\t\t\t\t\t\t<input [disabled]=\"field.isReadonly()\" type=\"button\" class=\"btn btn-default btn-footer\" (click)=\"field.onClick()\" value=\"{{field.name}}\"/>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"col-md-10 buttons-smartphone-right\">\r\n\t\t\t\t\t<span *ngFor='let field of form.fields' [hidden]=\"!field.visible\">\r\n\t\t\t\t\t\t<span *ngIf=\"field.type == 'okButton'\">\r\n\t\t\t\t\t\t\t<input [disabled]=\"field.isReadonly()\" type=\"submit\" class=\"btn btn-default btn-footer\" (click)=\"field.onClick()\" value=\"{{field.name}}\"/>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t<span *ngIf=\"field.type == 'cancelButton'\">\r\n\t\t\t\t\t\t\t<input [disabled]=\"field.isReadonly()\" type=\"button\" class=\"btn btn-default btn-footer\" (click)=\"field.onClick()\" value=\"{{field.name}}\"/>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n                </div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<!-- default version for desktop devices -->\r\n\t\t<div class=\"hide-on-mobile\">\r\n\t\t\t<div [hidden]=\"!form.footerVisible\" class=\"modal-footer\">\r\n\t\t\t<div class=\"row\">\r\n\t\t\t\t<div class=\"col-md-2\">\r\n\t\t\t\t\t\t<span *ngFor='let field of form.fields' class=\"pull-left\" [hidden]=\"!field.visible\">\r\n\t\t\t\t\t\t\t<span *ngIf=\"field.type == 'deleteButton'\">\r\n\t\t\t\t\t\t\t\t<input [disabled]=\"field.isReadonly()\" type=\"button\" class=\"btn btn-default btn-footer\" (click)=\"field.onClick()\" value=\"{{field.name}}\"/>\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t<span *ngIf=\"field.type == 'previousButton'\">\r\n\t\t\t\t\t\t\t\t<input [disabled]=\"field.isReadonly()\" type=\"button\" class=\"btn btn-default btn-footer\" (click)=\"field.onClick()\" value=\"{{field.name}}\"/>\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"col-md-10\">\r\n\t\t\t\t\t\t<span *ngFor='let field of form.fields' [hidden]=\"!field.visible\">\r\n\t\t\t\t\t\t\t<span *ngIf=\"field.type == 'okButton'\">\r\n\t\t\t\t\t\t\t\t<input [disabled]=\"field.isReadonly()\" type=\"submit\" class=\"btn btn-default btn-footer\" (click)=\"field.onClick()\" value=\"{{field.name}}\"/>\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t<span *ngIf=\"field.type == 'cancelButton'\">\r\n\t\t\t\t\t\t\t\t<input [disabled]=\"field.isReadonly()\" type=\"button\" class=\"btn btn-default btn-footer\" (click)=\"field.onClick()\" value=\"{{field.name}}\"/>\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</form>\r\n</div>"
        })
    ], FormComponent);
    return FormComponent;
}());
export { FormComponent };
var Form = /** @class */ (function () {
    function Form(pathService, app) {
        this.pathService = pathService;
        this.app = app;
        this._fields = [];
        this._rows = [];
        this._headerVisible = true;
        this._footerVisible = true;
        this._borderStyle = BorderStyle.Shadow;
    }
    Form.prototype.getApp = function () {
        return this.app;
    };
    Form.prototype.getKey = function () {
        return this.key;
    };
    Object.defineProperty(Form.prototype, "key", {
        get: function () {
            return this._key;
        },
        set: function (value) {
            this._key = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Form.prototype, "rows", {
        get: function () {
            return this._rows;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Form.prototype, "title", {
        get: function () {
            return this._title;
        },
        set: function (value) {
            this._title = value;
        },
        enumerable: true,
        configurable: true
    });
    Form.prototype.getFields = function () {
        return this.fields;
    };
    Object.defineProperty(Form.prototype, "fields", {
        get: function () {
            return this._fields;
        },
        set: function (value) {
            this._fields = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Form.prototype, "handler", {
        get: function () {
            return this._handler;
        },
        set: function (value) {
            this._handler = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Form.prototype, "url", {
        get: function () {
            return this._url;
        },
        set: function (value) {
            this._url = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Form.prototype, "bean", {
        get: function () {
            return this._bean;
        },
        set: function (value) {
            this._bean = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Form.prototype, "formFunction", {
        get: function () {
            return this._formFunction;
        },
        set: function (value) {
            this._formFunction = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Form.prototype, "headerVisible", {
        get: function () {
            return this._headerVisible;
        },
        set: function (value) {
            this._headerVisible = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Form.prototype, "footerVisible", {
        get: function () {
            return this._footerVisible;
        },
        set: function (value) {
            this._footerVisible = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Form.prototype, "borderStyle", {
        get: function () {
            return this._borderStyle;
        },
        set: function (value) {
            this._borderStyle = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Form.prototype, "urlDefaults", {
        get: function () {
            return this._urlDefaults;
        },
        enumerable: true,
        configurable: true
    });
    Form.prototype.fromJson = function (modelForm) {
        this.url = modelForm["url"];
        if (modelForm["urlDefaults"] != null) {
            this._urlDefaults = modelForm["urlDefaults"];
        }
        this.headerVisible = true;
        if (modelForm["headerVisible"] != null) {
            this.headerVisible = modelForm["headerVisible"];
        }
        this.footerVisible = true;
        if (modelForm["footerVisible"] != null) {
            this.footerVisible = modelForm["footerVisible"];
        }
        this.borderStyle = BorderStyle.Shadow;
        if (modelForm["borderStyle"] != null) {
            var borderStyleString = modelForm["borderStyle"];
            this.borderStyle = BorderStyle[borderStyleString];
        }
    };
    Form.prototype.updateRows = function () {
        var e_1, _a, e_2, _b;
        var rows = [];
        var currentFormRow;
        try {
            for (var _c = tslib_1.__values(this.fields), _d = _c.next(); !_d.done; _d = _c.next()) {
                var field = _d.value;
                if (field instanceof FieldListField) {
                    try {
                        for (var _e = (e_2 = void 0, tslib_1.__values(field.subfields)), _f = _e.next(); !_f.done; _f = _e.next()) {
                            var subField = _f.value;
                            currentFormRow = this.calculateFieldRow(subField, currentFormRow, rows);
                            currentFormRow.fields.push(subField);
                        }
                    }
                    catch (e_2_1) { e_2 = { error: e_2_1 }; }
                    finally {
                        try {
                            if (_f && !_f.done && (_b = _e.return)) _b.call(_e);
                        }
                        finally { if (e_2) throw e_2.error; }
                    }
                }
                else {
                    currentFormRow = this.calculateFieldRow(field, currentFormRow, rows);
                    currentFormRow.fields.push(field);
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
            }
            finally { if (e_1) throw e_1.error; }
        }
        this._rows = rows;
    };
    Form.prototype.calculateFieldRow = function (field, currentFormRow, rows) {
        // auto-start new row with form width 2
        if (currentFormRow == null ||
            field.newRow ||
            currentFormRow.fields.length >= 2 ||
            field.width >= 2 ||
            currentFormRow.getWidth() >= 2) {
            field.newRow = true;
            currentFormRow = new FormRow();
            rows.push(currentFormRow);
        }
        return currentFormRow;
    };
    Form.prototype.close = function (save, remove) {
        var e_3, _a, e_4, _b;
        if (save || remove) {
            // call close handler
            if (this.handler != null) {
                this.handler.doSave(this._bean);
            }
            var data = {};
            try {
                for (var _c = tslib_1.__values(this._fields), _d = _c.next(); !_d.done; _d = _c.next()) {
                    var field = _d.value;
                    if (field instanceof ValueField && field.id != null) {
                        data[field.id] = field.value;
                    }
                    if (field instanceof FieldListField) {
                        try {
                            for (var _e = (e_4 = void 0, tslib_1.__values(field.subfields)), _f = _e.next(); !_f.done; _f = _e.next()) {
                                var subfield = _f.value;
                                data[subfield.id] = subfield.value;
                            }
                        }
                        catch (e_4_1) { e_4 = { error: e_4_1 }; }
                        finally {
                            try {
                                if (_f && !_f.done && (_b = _e.return)) _b.call(_e);
                            }
                            finally { if (e_4) throw e_4.error; }
                        }
                    }
                }
            }
            catch (e_3_1) { e_3 = { error: e_3_1 }; }
            finally {
                try {
                    if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
                }
                finally { if (e_3) throw e_3.error; }
            }
            if (remove) {
                this.pathService.serverDelete(this.app.getBackendUrl(), this.url, this.formFunction.delete);
            }
            else if (this.key == null) {
                // create
                this.pathService.serverPost(this.app.getBackendUrl(), this.url, data, this.formFunction.save, null);
            }
            else {
                // update (with key)
                this.pathService.serverPut(this.app.getBackendUrl(), this.url, data, this.formFunction.save);
            }
        }
        else {
            this.formFunction.cancel();
        }
    };
    Form.prototype.onKey = function (event) {
        if (event.keyCode === 27) { // esc
            this.close(false, false);
        }
    };
    return Form;
}());
export { Form };
var FormRow = /** @class */ (function () {
    function FormRow() {
        this._fields = [];
    }
    Object.defineProperty(FormRow.prototype, "fields", {
        get: function () {
            return this._fields;
        },
        set: function (value) {
            this._fields = value;
        },
        enumerable: true,
        configurable: true
    });
    FormRow.prototype.getWidth = function () {
        var e_5, _a;
        var sum = 0;
        try {
            for (var _b = tslib_1.__values(this.fields), _c = _b.next(); !_c.done; _c = _b.next()) {
                var field = _c.value;
                sum += field.width;
            }
        }
        catch (e_5_1) { e_5 = { error: e_5_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_5) throw e_5.error; }
        }
        return sum;
    };
    FormRow.prototype.isVisible = function () {
        var e_6, _a;
        try {
            for (var _b = tslib_1.__values(this.fields), _c = _b.next(); !_c.done; _c = _b.next()) {
                var field = _c.value;
                if (field.visible) {
                    return true;
                }
            }
        }
        catch (e_6_1) { e_6 = { error: e_6_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_6) throw e_6.error; }
        }
        return false;
    };
    return FormRow;
}());
export { FormRow };
export var BorderStyle;
(function (BorderStyle) {
    // TODO use string enum after TS upgrade, then use enum in template (with member)
    BorderStyle[BorderStyle["None"] = 1] = "None";
    BorderStyle[BorderStyle["Shadow"] = 2] = "Shadow";
})(BorderStyle || (BorderStyle = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9wYXRoLWZyYW1ld29yay8iLCJzb3VyY2VzIjpbInBhdGgtZnJhbWV3b3JrL2Zvcm0vZm9ybS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBZ0IsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFHdEUsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBRS9DLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSw4Q0FBOEMsQ0FBQztBQUk1RSxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFNN0M7SUFBQTtJQVlBLENBQUM7SUFQVSxnQ0FBUSxHQUFmO1FBQ0ksSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFFRCx1Q0FBZSxHQUFmO1FBQ0ksWUFBWSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDNUMsQ0FBQztJQVJEO1FBRkMsS0FBSyxDQUFDLE1BQU0sQ0FBQztRQUNiLE1BQU0sQ0FBQyxNQUFNLENBQUM7K0NBQ0o7SUFIRixhQUFhO1FBSnpCLFNBQVMsQ0FBQztZQUNQLFFBQVEsRUFBRSxXQUFXO1lBQ3JCLDhpTEFBa0M7U0FDckMsQ0FBQztPQUNXLGFBQWEsQ0FZekI7SUFBRCxvQkFBQztDQUFBLEFBWkQsSUFZQztTQVpZLGFBQWE7QUFjMUI7SUFjSSxjQUFvQixXQUF3QixFQUFVLEdBQWE7UUFBL0MsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFBVSxRQUFHLEdBQUgsR0FBRyxDQUFVO1FBWDNELFlBQU8sR0FBZ0IsRUFBRSxDQUFDO1FBQzFCLFVBQUssR0FBYyxFQUFFLENBQUM7UUFNdEIsbUJBQWMsR0FBRyxJQUFJLENBQUM7UUFDdEIsbUJBQWMsR0FBRyxJQUFJLENB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TSxDQUFOLElBQVksV0FJWDtBQUpELFdBQVksV0FBVztJQUNuQixpRkFBaUY7SUFDakYsNkNBQVEsQ0FBQTtJQUNSLGlEQUFVLENBQUE7QUFDZCxDQUFDLEVBSlcsV0FBVyxLQUFYLFdBQVcsUUFJdEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0FmdGVyVmlld0luaXQsIENvbXBvbmVudCwgSW5wdXQsIE91dHB1dH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHtQYXRoU2VydmljZX0gZnJvbSBcIi4uL3NlcnZpY2UvcGF0aC5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7SUZvcm0sIElQYXRoQXBwLCBJRm9ybUhhbmRsZXIsIElGb3JtQmVhbn0gZnJvbSBcIi4uL3BhdGhpbnRlcmZhY2VcIjtcclxuaW1wb3J0IHtWYWx1ZUZpZWxkfSBmcm9tIFwiLi9maWVsZC92YWx1ZS1maWVsZFwiO1xyXG5pbXBvcnQge0Zvcm1GaWVsZH0gZnJvbSBcIi4vZmllbGQvZm9ybS1maWVsZFwiO1xyXG5pbXBvcnQge0ZpZWxkTGlzdEZpZWxkfSBmcm9tIFwiLi9maWVsZC9maWVsZExpc3QvZmllbGQtbGlzdC1maWVsZC5jb21wb25lbnRcIjtcclxuaW1wb3J0IHtLZXl9IGZyb20gXCIuLi9wYWdlL2VsZW1lbnQvcGFnZS1lbGVtZW50XCI7XHJcbmltcG9ydCB7Rm9ybUZ1bmN0aW9ufSBmcm9tIFwiLi9mb3JtLWZ1bmN0aW9uXCI7XHJcbmltcG9ydCB7VHJhbnNsYXRpb25TZXJ2aWNlfSBmcm9tIFwiLi4vc2VydmljZS90cmFuc2xhdGlvbi5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7Rm9jdXNVdGlsaXR5fSBmcm9tIFwiLi9mb2N1cy11dGlsaXR5XCI7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiBcInBhdGgtZm9ybVwiLFxyXG4gICAgdGVtcGxhdGVVcmw6IFwiZm9ybS5jb21wb25lbnQuaHRtbFwiLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgRm9ybUNvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQge1xyXG4gICAgQElucHV0KFwiZm9ybVwiKVxyXG4gICAgQE91dHB1dChcImZvcm1cIilcclxuICAgIGZvcm06IEZvcm07XHJcblxyXG4gICAgcHVibGljIG9uU3VibWl0KCkge1xyXG4gICAgICAgIHRoaXMuZm9ybS5jbG9zZSh0cnVlLCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIEZvY3VzVXRpbGl0eS5mb2N1c0ZpcnN0RmllbGQodGhpcy5mb3JtKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEZvcm0gaW1wbGVtZW50cyBJRm9ybSB7XHJcbiAgICBwcml2YXRlIF9rZXk6IEtleTtcclxuICAgIHByaXZhdGUgX3RpdGxlOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF9maWVsZHM6IEZvcm1GaWVsZFtdID0gW107XHJcbiAgICBwcml2YXRlIF9yb3dzOiBGb3JtUm93W10gPSBbXTtcclxuICAgIHByaXZhdGUgX2hhbmRsZXI6IElGb3JtSGFuZGxlcjtcclxuICAgIHByaXZhdGUgX3VybDogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSBfdXJsRGVmYXVsdHM6IGJvb2xlYW47XHJcbiAgICBwcml2YXRlIF9iZWFuOiBJRm9ybUJlYW47XHJcbiAgICBwcml2YXRlIF9mb3JtRnVuY3Rpb246IEZvcm1GdW5jdGlvbjtcclxuICAgIHByaXZhdGUgX2hlYWRlclZpc2libGUgPSB0cnVlO1xyXG4gICAgcHJpdmF0ZSBfZm9vdGVyVmlzaWJsZSA9IHRydWU7XHJcbiAgICBwcml2YXRlIF9ib3JkZXJTdHlsZTogQm9yZGVyU3R5bGUgPSBCb3JkZXJTdHlsZS5TaGFkb3c7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBwYXRoU2VydmljZTogUGF0aFNlcnZpY2UsIHByaXZhdGUgYXBwOiBJUGF0aEFwcCkge1xyXG4gICAgfVxyXG5cclxuICAgIGdldEFwcCgpOiBJUGF0aEFwcCB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYXBwO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEtleSgpOiBLZXkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmtleTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQga2V5KCk6IEtleSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2tleTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQga2V5KHZhbHVlOiBLZXkpIHtcclxuICAgICAgICB0aGlzLl9rZXkgPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgcm93cygpOiBGb3JtUm93W10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9yb3dzO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB0aXRsZSgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl90aXRsZTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgdGl0bGUodmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuX3RpdGxlID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldEZpZWxkcygpOiBGb3JtRmllbGRbXSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZmllbGRzO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBmaWVsZHMoKTogRm9ybUZpZWxkW10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9maWVsZHM7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGZpZWxkcyh2YWx1ZTogRm9ybUZpZWxkW10pIHtcclxuICAgICAgICB0aGlzLl9maWVsZHMgPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgaGFuZGxlcigpOiBJRm9ybUhhbmRsZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVyO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBoYW5kbGVyKHZhbHVlOiBJRm9ybUhhbmRsZXIpIHtcclxuICAgICAgICB0aGlzLl9oYW5kbGVyID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHVybCgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl91cmw7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHVybCh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5fdXJsID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGJlYW4oKTogSUZvcm1CZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYmVhbjtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgYmVhbih2YWx1ZTogSUZvcm1CZWFuKSB7XHJcbiAgICAgICAgdGhpcy5fYmVhbiA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBmb3JtRnVuY3Rpb24oKTogRm9ybUZ1bmN0aW9uIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZm9ybUZ1bmN0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBmb3JtRnVuY3Rpb24odmFsdWU6IEZvcm1GdW5jdGlvbikge1xyXG4gICAgICAgIHRoaXMuX2Zvcm1GdW5jdGlvbiA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBoZWFkZXJWaXNpYmxlKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9oZWFkZXJWaXNpYmxlO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBoZWFkZXJWaXNpYmxlKHZhbHVlOiBib29sZWFuKSB7XHJcbiAgICAgICAgdGhpcy5faGVhZGVyVmlzaWJsZSA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBmb290ZXJWaXNpYmxlKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9mb290ZXJWaXNpYmxlO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBmb290ZXJWaXNpYmxlKHZhbHVlOiBib29sZWFuKSB7XHJcbiAgICAgICAgdGhpcy5fZm9vdGVyVmlzaWJsZSA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBib3JkZXJTdHlsZSgpOiBCb3JkZXJTdHlsZSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2JvcmRlclN0eWxlO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBib3JkZXJTdHlsZSh2YWx1ZTogQm9yZGVyU3R5bGUpIHtcclxuICAgICAgICB0aGlzLl9ib3JkZXJTdHlsZSA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB1cmxEZWZhdWx0cygpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdXJsRGVmYXVsdHM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGZyb21Kc29uKG1vZGVsRm9ybSkge1xyXG4gICAgICAgIHRoaXMudXJsID0gbW9kZWxGb3JtW1widXJsXCJdO1xyXG4gICAgICAgIGlmIChtb2RlbEZvcm1bXCJ1cmxEZWZhdWx0c1wiXSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3VybERlZmF1bHRzID0gbW9kZWxGb3JtW1widXJsRGVmYXVsdHNcIl07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaGVhZGVyVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgaWYgKG1vZGVsRm9ybVtcImhlYWRlclZpc2libGVcIl0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLmhlYWRlclZpc2libGUgPSBtb2RlbEZvcm1bXCJoZWFkZXJWaXNpYmxlXCJdO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmZvb3RlclZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIGlmIChtb2RlbEZvcm1bXCJmb290ZXJWaXNpYmxlXCJdICE9IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5mb290ZXJWaXNpYmxlID0gbW9kZWxGb3JtW1wiZm9vdGVyVmlzaWJsZVwiXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5ib3JkZXJTdHlsZSA9IEJvcmRlclN0eWxlLlNoYWRvdztcclxuICAgICAgICBpZiAobW9kZWxGb3JtW1wiYm9yZGVyU3R5bGVcIl0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBjb25zdCBib3JkZXJTdHlsZVN0cmluZzogc3RyaW5nID0gbW9kZWxGb3JtW1wiYm9yZGVyU3R5bGVcIl07XHJcbiAgICAgICAgICAgIHRoaXMuYm9yZGVyU3R5bGUgPSBCb3JkZXJTdHlsZVtib3JkZXJTdHlsZVN0cmluZ107XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyB1cGRhdGVSb3dzKCkge1xyXG4gICAgICAgIGNvbnN0IHJvd3M6IEZvcm1Sb3dbXSA9IFtdO1xyXG5cclxuICAgICAgICBsZXQgY3VycmVudEZvcm1Sb3c6IEZvcm1Sb3c7XHJcbiAgICAgICAgZm9yIChjb25zdCBmaWVsZCBvZiB0aGlzLmZpZWxkcykge1xyXG4gICAgICAgICAgICBpZiAoZmllbGQgaW5zdGFuY2VvZiBGaWVsZExpc3RGaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBzdWJGaWVsZCBvZiAoPEZpZWxkTGlzdEZpZWxkPmZpZWxkKS5zdWJmaWVsZHMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50Rm9ybVJvdyA9IHRoaXMuY2FsY3VsYXRlRmllbGRSb3coc3ViRmllbGQsIGN1cnJlbnRGb3JtUm93LCByb3dzKTtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50Rm9ybVJvdy5maWVsZHMucHVzaChzdWJGaWVsZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50Rm9ybVJvdyA9IHRoaXMuY2FsY3VsYXRlRmllbGRSb3coZmllbGQsIGN1cnJlbnRGb3JtUm93LCByb3dzKTtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRGb3JtUm93LmZpZWxkcy5wdXNoKGZpZWxkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9yb3dzID0gcm93cztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNhbGN1bGF0ZUZpZWxkUm93KGZpZWxkOiBGb3JtRmllbGQsIGN1cnJlbnRGb3JtUm93OiBGb3JtUm93LCByb3dzOiBGb3JtUm93W10pOiBGb3JtUm93IHtcclxuICAgICAgICAvLyBhdXRvLXN0YXJ0IG5ldyByb3cgd2l0aCBmb3JtIHdpZHRoIDJcclxuICAgICAgICBpZiAoY3VycmVudEZvcm1Sb3cgPT0gbnVsbCB8fFxyXG4gICAgICAgICAgICBmaWVsZC5uZXdSb3cgfHxcclxuICAgICAgICAgICAgY3VycmVudEZvcm1Sb3cuZmllbGRzLmxlbmd0aCA+PSAyIHx8XHJcbiAgICAgICAgICAgIGZpZWxkLndpZHRoID49IDIgfHxcclxuICAgICAgICAgICAgY3VycmVudEZvcm1Sb3cuZ2V0V2lkdGgoKSA+PSAyXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIGZpZWxkLm5ld1JvdyA9IHRydWU7XHJcbiAgICAgICAgICAgIGN1cnJlbnRGb3JtUm93ID0gbmV3IEZvcm1Sb3coKTtcclxuICAgICAgICAgICAgcm93cy5wdXNoKGN1cnJlbnRGb3JtUm93KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRGb3JtUm93O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjbG9zZShzYXZlOiBib29sZWFuLCByZW1vdmU6IGJvb2xlYW4pIHtcclxuICAgICAgICBpZiAoc2F2ZSB8fCByZW1vdmUpIHtcclxuICAgICAgICAgICAgLy8gY2FsbCBjbG9zZSBoYW5kbGVyXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmhhbmRsZXIgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVyLmRvU2F2ZSh0aGlzLl9iZWFuKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBkYXRhID0ge307XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgZmllbGQgb2YgdGhpcy5fZmllbGRzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmllbGQgaW5zdGFuY2VvZiBWYWx1ZUZpZWxkICYmIGZpZWxkLmlkICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhW2ZpZWxkLmlkXSA9ICg8VmFsdWVGaWVsZDxhbnk+PmZpZWxkKS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChmaWVsZCBpbnN0YW5jZW9mIEZpZWxkTGlzdEZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBzdWJmaWVsZCBvZiAoPEZpZWxkTGlzdEZpZWxkPmZpZWxkKS5zdWJmaWVsZHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtzdWJmaWVsZC5pZF0gPSAoPFZhbHVlRmllbGQ8YW55Pj5zdWJmaWVsZCkudmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChyZW1vdmUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGF0aFNlcnZpY2Uuc2VydmVyRGVsZXRlKHRoaXMuYXBwLmdldEJhY2tlbmRVcmwoKSwgdGhpcy51cmwsIHRoaXMuZm9ybUZ1bmN0aW9uLmRlbGV0ZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5rZXkgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgLy8gY3JlYXRlXHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhdGhTZXJ2aWNlLnNlcnZlclBvc3QodGhpcy5hcHAuZ2V0QmFja2VuZFVybCgpLCB0aGlzLnVybCwgZGF0YSwgdGhpcy5mb3JtRnVuY3Rpb24uc2F2ZSwgbnVsbCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgKHdpdGgga2V5KVxyXG4gICAgICAgICAgICAgICAgdGhpcy5wYXRoU2VydmljZS5zZXJ2ZXJQdXQodGhpcy5hcHAuZ2V0QmFja2VuZFVybCgpLCB0aGlzLnVybCwgZGF0YSwgdGhpcy5mb3JtRnVuY3Rpb24uc2F2ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmZvcm1GdW5jdGlvbi5jYW5jZWwoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG9uS2V5KGV2ZW50KSB7XHJcbiAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDI3KSB7IC8vIGVzY1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlKGZhbHNlLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgRm9ybVJvdyB7XHJcbiAgICBwcml2YXRlIF9maWVsZHM6IEZvcm1GaWVsZFtdID0gW107XHJcblxyXG4gICAgZ2V0IGZpZWxkcygpOiBGb3JtRmllbGRbXSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpZWxkcztcclxuICAgIH1cclxuXHJcbiAgICBzZXQgZmllbGRzKHZhbHVlOiBGb3JtRmllbGRbXSkge1xyXG4gICAgICAgIHRoaXMuX2ZpZWxkcyA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRXaWR0aCgpOiBudW1iZXIge1xyXG4gICAgICAgIGxldCBzdW0gPSAwO1xyXG4gICAgICAgIGZvciAoY29uc3QgZmllbGQgb2YgdGhpcy5maWVsZHMpIHtcclxuICAgICAgICAgICAgc3VtICs9IGZpZWxkLndpZHRoO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc3VtO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBpc1Zpc2libGUoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgZm9yIChjb25zdCBmaWVsZCBvZiB0aGlzLmZpZWxkcykge1xyXG4gICAgICAgICAgICBpZiAoZmllbGQudmlzaWJsZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZW51bSBCb3JkZXJTdHlsZSB7XHJcbiAgICAvLyBUT0RPIHVzZSBzdHJpbmcgZW51bSBhZnRlciBUUyB1cGdyYWRlLCB0aGVuIHVzZSBlbnVtIGluIHRlbXBsYXRlICh3aXRoIG1lbWJlcilcclxuICAgIE5vbmUgPSAxLFxyXG4gICAgU2hhZG93ID0gMlxyXG59XHJcbiJdfQ==